{"version":3,"file":"index-BxqX04_L.js","sources":["../../src/upgrades/blasters.ts","../../src/upgrades/follower.ts","../../src/upgrades/rockets.ts","../../src/upgrades/ship.ts","../../src/upg.ts","../../src/util.ts","../../src/player.ts","../../src/particles.ts","../../src/wave.ts","../../src/tags.ts","../../src/gameUi.ts","../../src/projectiles/blaster.ts","../../src/shared.ts","../../src/projectiles/rocket.ts","../../src/setupPlayer.ts","../../src/spawn/spawnDebree.ts","../../src/spawn/spawnAssasin.ts","../../src/spawn/spawnAsteroid.ts","../../src/spawn/spawnGenericVehicle.ts","../../src/spawn/spawnHighway.ts","../../src/compose.ts","../../src/comp/jitter.ts","../../src/spawn/spawnShip1.ts","../../src/web.ts","../../src/levels/level1.ts","../../src/comp/target.ts","../../src/spawn/spawnFollower.ts","../../src/game.ts","../../src/levelUp.ts","../../src/main.ts"],"sourcesContent":["import { Tool } from \"../upg\";\n\nexport const blaster: Tool = {\n\ttoolName: \"Blaster\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Add a blaster at the front of the ship as firepower\",\n\t\t\tprice: 12,\n\t\t\tsprite: \"blaster1\",\n\t\t\tvalue: 1,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Add a second blaster to your ship\",\n\t\t\tprice: 12,\n\t\t\tsprite: \"blaster1\",\n\t\t\tvalue: 2,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 3\",\n\t\t\tdesc: \"Add a third blaster to your ship\",\n\t\t\tprice: 12,\n\t\t\tsprite: \"blaster1\",\n\t\t\tvalue: 3,\n\t\t},\n\t],\n};\n\nexport const blasterMultiple: Tool = {\n\ttoolName: \"Blaster wires\",\n\trequiredTool: \"blaster\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Fire all blasters at the same time\",\n\t\t\tprice: 12,\n\t\t\tsprite: \"blaster_upg_speed1\",\n\t\t\tvalue: 1,\n\t\t},\n\t],\n};\n\nexport const blasterSpeed: Tool = {\n\ttoolName: \"Blaster speed\",\n\trequiredTool: \"blaster\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Increase velocity of blaster projectiles\",\n\t\t\tprice: 12,\n\t\t\tsprite: \"blaster_upg_speed1\",\n\t\t\tvalue: 1.65,\n\t\t},\n\t],\n};\n\nexport const blasterDmg: Tool = {\n\ttoolName: \"Blaster dmg\",\n\trequiredTool: \"blaster\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Increase damage of the ships primary blasters\",\n\t\t\tprice: 12,\n\t\t\tsprite: \"blaster_upg_dmg1\",\n\t\t\tvalue: 2,\n\t\t},\n\t],\n};\n","import { Tool } from \"../upg\";\n\nexport const follower: Tool = {\n\ttoolName: \"Followers\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Purchase a follower for your social media account\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 1,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Your social media is blowing up\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 2,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 3\",\n\t\t\tdesc: \"Wow, you are popular!!\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 3,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 4\",\n\t\t\tdesc: \"Alright rockstar...\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 10,\n\t\t},\n\t],\n};\n\nexport const followerBlasterDmg: Tool = {\n\ttoolName: \"Followers\",\n\trequiredTool: \"follower\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Increase your followers social media likes\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 1,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Too... Many... Likes...\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 2,\n\t\t},\n\t],\n};\n\nexport const followerMissiles: Tool = {\n\ttoolName: \"Followers\",\n\trequiredTool: \"follower\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Your followers will become quite dangerous\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 1,\n\t\t},\n\t],\n};\n","import { Tool } from \"../upg\";\n\nexport const rocket: Tool = {\n\ttoolName: \"Missile barrage\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Install missile pods to the ship\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 1,\n\t\t},\n\t],\n};\n\nexport const increaseRockets: Tool = {\n\ttoolName: \"Increase missiles\",\n\trequiredTool: \"rockets\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Increase missiles to 6\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 6,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Increase missiles to 8\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 8,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 3\",\n\t\t\tdesc: \"Increase missiles to 10\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 10,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 4\",\n\t\t\tdesc: \"Increase missiles to 16, missiles will be taped outside the pod\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 16,\n\t\t},\n\t],\n};\n\nexport const rocketShards: Tool = {\n\ttoolName: \"Missile shards\",\n\trequiredTool: \"rockets\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Missiles are loaded with space debree, shooting shards when exploded\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 1,\n\t\t},\n\t],\n};\n\nexport const rocketShardsAmount: Tool = {\n\ttoolName: \"Moar missile shards\",\n\trequiredTool: \"rocketShards\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Squeeze some more debree in those missiles!!\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 5,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Squeeze some more debree in those missiles!!\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 7,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 3\",\n\t\t\tdesc: \"Squeeze some more debree in those missiles!!\",\n\t\t\tsprite: \"rocket_upg1\",\n\t\t\tprice: 22,\n\t\t\tvalue: 9,\n\t\t},\n\t],\n};\n","import { Tool } from \"../upg\";\n\nexport const debreeDist: Tool = {\n\ttoolName: \"Debree magnets\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Upgrade the ships magnetic magnets and increase debree collect distance\",\n\t\t\tsprite: \"debree_dist_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.2,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Upgrade the ships magnetic magnets and increase debree collect distance\",\n\t\t\tsprite: \"debree_dist_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.4,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 3\",\n\t\t\tdesc: \"Upgrade the ships magnetic magnets and increase debree collect distance\",\n\t\t\tsprite: \"debree_dist_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.6,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 4\",\n\t\t\tdesc: \"Upgrade the ships magnetic magnets and increase debree collect distance\",\n\t\t\tsprite: \"debree_dist_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.8,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 5\",\n\t\t\tdesc: \"Upgrade the ships magnetic magnets and increase debree collect distance\",\n\t\t\tsprite: \"debree_dist_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 2,\n\t\t},\n\t],\n};\n\nexport const debreeSpeed: Tool = {\n\ttoolName: \"Stronger magnets\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Stronger magnets = faster debree, easy math\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.2,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Stronger magnets = faster debree, easy math\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.4,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 3\",\n\t\t\tdesc: \"Stronger magnets = faster debree, easy math\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 2,\n\t\t},\n\t],\n};\n\nexport const sprint: Tool = {\n\ttoolName: \"Thrusters overclock\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Hold SHIFT to overclock thrusters, increasing speed\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.2,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Increase speed when overclocking thrusters\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.4,\n\t\t},\n\t],\n};\n\nexport const sprintSpeed: Tool = {\n\ttoolName: \"Thrusters cooling\",\n\trequiredTool: \"sprint\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Overclocking thrusters gains more speed\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.3,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Overclocking thrusters gains more speed\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.4,\n\t\t},\n\t],\n};\n\nexport const movespeed: Tool = {\n\ttoolName: \"Upgraded thrusters\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Increase ship move speed\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.05,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Increase ship move speed\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 1.15,\n\t\t},\n\t],\n};\n\nexport const debreeValue: Tool = {\n\ttoolName: \"Shiny debree\",\n\trequiredTool: \"debreeDist\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Debree becomes more valueable, who could have thought\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 2,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Debree becomes almost as valuable as gold\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 3,\n\t\t},\n\t],\n};\n\nexport const maxHealth: Tool = {\n\ttoolName: \"Stronger hull\",\n\tupgrades: [\n\t\t{\n\t\t\tname: \"Level 1\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 3,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 2\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 4,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 3\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 5,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 4\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 6,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 5\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 7,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 6\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 8,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 7\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 9,\n\t\t},\n\t\t{\n\t\t\tname: \"Level 8\",\n\t\t\tdesc: \"Upgrade hull and increase health by one\",\n\t\t\tsprite: \"debree_speed_upg1\",\n\t\t\tprice: 32,\n\t\t\tvalue: 10,\n\t\t},\n\t],\n};\n","import {\n\tblaster,\n\tblasterDmg,\n\tblasterMultiple,\n\tblasterSpeed,\n} from \"./upgrades/blasters\";\nimport {\n\tfollower,\n\tfollowerBlasterDmg,\n\tfollowerMissiles,\n} from \"./upgrades/follower\";\nimport {\n\tincreaseRockets,\n\trocket,\n\trocketShards,\n\trocketShardsAmount,\n} from \"./upgrades/rockets\";\nimport {\n\tdebreeDist,\n\tdebreeSpeed,\n\tdebreeValue,\n\tmaxHealth,\n\tmovespeed,\n\tsprint,\n\tsprintSpeed,\n} from \"./upgrades/ship\";\nimport { saveGame } from \"./util\";\n\ninterface Upgrade {\n\tname: string;\n\tdesc: string;\n\tprice: number;\n\tsprite: string;\n\tvalue: number;\n}\n\nexport type ToolKey = keyof typeof upgrades;\n\nexport interface Tool {\n\ttoolName: string;\n\trequiredTool?: ToolKey;\n\tupgrades: Upgrade[];\n}\n\nexport const upgrades = {\n\tblaster: blaster,\n\tblasterParallel: blasterMultiple,\n\tblasterDmg: blasterDmg,\n\tblasterSpeed: blasterSpeed,\n\n\trockets: rocket,\n\tnrOfRockets: increaseRockets,\n\trocketShards: rocketShards,\n\trocketShardsAmount: rocketShardsAmount,\n\n\tdebreeDist: debreeDist,\n\tdebreeSpeed: debreeSpeed,\n\tdebreeValue: debreeValue,\n\n\tsprint: sprint,\n\tsprintSpeed: sprintSpeed,\n\n\tmovespeed: movespeed,\n\tmaxHealth: maxHealth,\n\n\tfollower: follower,\n\tfollowerBlasterDmg: followerBlasterDmg,\n\tfollowerMissiles: followerMissiles,\n} as const;\n\nexport let loadout: Record<ToolKey, number | undefined> = {\n\tblaster: undefined,\n\tblasterDmg: undefined,\n\tblasterSpeed: undefined,\n\trockets: undefined,\n\tdebreeDist: undefined,\n\tdebreeSpeed: undefined,\n\tnrOfRockets: undefined,\n\tsprint: undefined,\n\tmovespeed: undefined,\n\tdebreeValue: undefined,\n\tmaxHealth: undefined,\n\tfollower: undefined,\n\tfollowerBlasterDmg: undefined,\n\tfollowerMissiles: undefined,\n\trocketShards: undefined,\n\trocketShardsAmount: undefined,\n\tsprintSpeed: undefined,\n\tblasterParallel: undefined,\n};\n\nexport function getToolUpgradeLvlValue(key: ToolKey) {\n\tif (loadout[key] === undefined) return undefined;\n\n\treturn upgrades[key].upgrades[loadout[key]].value;\n}\n\nexport function addLvl(key: ToolKey) {\n\tloadout[key] = getNextLvl(key);\n\tsaveGame(\"slot1\");\n}\n\nexport function getNextLvl(key: ToolKey) {\n\tif (loadout[key] === undefined) return 0;\n\treturn loadout[key] + 1;\n}\n\nexport function setLoadout(set: Record<string, number | undefined>) {\n\tloadout = set;\n}\n","import { KAPLAYCtx } from \"kaplay\";\nimport { loadout, upgrades } from \"./upg\";\nimport { score, timeSeconds } from \"./main\";\n\ninterface SaveSlot {\n\ttime: number;\n\tscore: number;\n\tloadout: Record<string, number | undefined>;\n}\n\nexport async function init(k: KAPLAYCtx<{}, never>) {\n\tawait k.loadRoot(\"./\"); // A good idea for Itch.io publishing later\n\tawait k.loadSprite(\"ship\", \"sprites/ship.png\");\n\tawait k.loadSprite(\"crate1\", \"sprites/crate1.png\");\n\tawait k.loadSprite(\"bullet1\", \"sprites/bullet1.png\");\n\tawait k.loadSprite(\"rocket1\", \"sprites/rocket1.png\");\n\n\tawait k.loadSprite(\"asteroid1\", \"sprites/asteroid1.png\");\n\tawait k.loadSprite(\"enemy_ship1\", \"sprites/enemy_ship1.png\");\n\tawait k.loadSprite(\"bike1\", \"sprites/bike1.png\");\n\n\tawait k.loadSprite(\"particle1\", \"sprites/particle1.png\");\n\tawait k.loadSprite(\"particle2\", \"sprites/particle2.png\");\n\tawait k.loadSprite(\"particle3\", \"sprites/particle3.png\");\n\tawait k.loadSprite(\"particle4\", \"sprites/particle4.png\");\n\tawait k.loadSprite(\"spark1\", \"sprites/spark1.png\");\n\n\tawait k.loadSprite(\"debree_part1\", \"sprites/debree_part1.png\");\n\n\tawait k.loadSprite(\"blaster1\", \"sprites/laser_cannon1.png\");\n\tawait k.loadSprite(\"rocket_upg1\", \"sprites/rocket_upg1.png\");\n\tawait k.loadSprite(\"blaster_upg_speed1\", \"sprites/blaster_upg_speed1.png\");\n\tawait k.loadSprite(\"blaster_upg_dmg1\", \"sprites/blaster_upg_dmg1.png\");\n\tawait k.loadSprite(\"debree_dist_upg1\", \"sprites/debree_dist_upg1.png\");\n\tawait k.loadSprite(\"debree_speed_upg1\", \"sprites/debree_speed_upg1.png\");\n\n\tawait k.loadSprite(\"bg_moon1\", \"sprites/bg/moon1.png\");\n\tawait k.loadSprite(\"bg_building1\", \"sprites/bg/building1.png\");\n\n\tawait k.loadBitmapFont(\"unscii\", \"/fonts/unscii_8x8.png\", 8, 8);\n\n\tawait k.loadSound(\"shoot1\", \"sounds/shoot1.wav\");\n\tawait k.loadSound(\"fire_rocket1\", \"sounds/rocket_fire1.wav\");\n\n\tawait k.loadSound(\"explosion1\", \"sounds/explosion1.wav\");\n\tawait k.loadSound(\"explosion2\", \"sounds/explosion2.wav\");\n\tawait k.loadSound(\"explosion3\", \"sounds/explosion3.wav\");\n\tawait k.loadSound(\"explosion4\", \"sounds/explosion4.wav\");\n\tawait k.loadSound(\"hit1\", \"sounds/hit1.wav\");\n\tawait k.loadSound(\"hit2\", \"sounds/hit2.wav\");\n\tawait k.loadSound(\"player_hit1\", \"sounds/player_hit1.wav\");\n\tawait k.loadSound(\"collect1\", \"sounds/collect1.wav\");\n\tawait k.loadSound(\"click1\", \"sounds/click.wav\");\n\tawait k.loadSound(\"purchase\", \"sounds/purchase.wav\");\n\tawait k.loadSound(\"error\", \"sounds/error.wav\");\n\tawait k.loadSound(\"purchase1\", \"sounds/purchase1.wav\");\n\n\tawait k.loadMusic(\"arcadia\", \"songs/arcadia.mp3\");\n\n\tawait k.loadSprite(\n\t\t\"enemy_ship1_left_wing\",\n\t\t\"sprites/ships/enemy1/enemy_ship1_left_wing.png\"\n\t);\n\tawait k.loadSprite(\n\t\t\"enemy_ship1_right_wing\",\n\t\t\"sprites/ships/enemy1/enemy_ship1_right_wing.png\"\n\t);\n\tawait k.loadSprite(\n\t\t\"enemy_ship1_body\",\n\t\t\"sprites/ships/enemy1/enemy_ship1_body.png\"\n\t);\n}\n\nconst explArr = [\"explosion1\", \"explosion2\", \"explosion3\"];\n\nexport function randomExplosion() {\n\tconst r = Math.floor(Math.random() * explArr.length);\n\treturn explArr[r];\n}\n\nexport function adjustedTarget(from, to) {\n\treturn from + shortestAngleDelta(from, to);\n}\n\nexport function shortestAngleDelta(from, to) {\n\tlet delta = (to - from) % 360;\n\tif (delta > 180) delta -= 360;\n\tif (delta < -180) delta += 360;\n\treturn delta;\n}\n\nexport function saveGame(slot: string) {\n\tconst save: SaveSlot = {\n\t\tloadout,\n\t\tscore: score,\n\t\ttime: timeSeconds,\n\t};\n\tlocalStorage.setItem(slot, JSON.stringify(save));\n}\nexport function loadGame(slot: string): SaveSlot | null {\n\tvar p = localStorage.getItem(slot);\n\n\tif (!p) return null;\n\n\treturn JSON.parse(p);\n}\n","import { getToolUpgradeLvlValue, ToolKey } from \"./upg\";\n\ninterface Ship {\n\tspeed: number;\n\tspeedMultiplier: number;\n\tspeedPwrUpMultiplier: number;\n\n\tcanSprint: number | undefined;\n\tsprintSpeedMultiplier: number;\n\n\tmaxHealth: number;\n\tscorePerPickup: number;\n\tblasterDmg: number;\n\tblasterDmgMultiplier: number;\n\tblasterSpeedMultiplier: number;\n\n\tdebreePickupDistance: number;\n\tdebreeSeekDistance: number;\n\tdebreeSeekDistanceMultiplier: number;\n\tdebreeSeekSpeed: number;\n\tdebreeSeekSpeedMultiplier: number;\n\tdebreeValueMultiplier: number;\n\n\tblasterLvl: number | undefined;\n\tblasterParallel: number | undefined;\n\trocketsLvl: number | undefined;\n\n\trocketImpactDmg: number;\n\trocketSplashDmg: number;\n\trocketDmgMultiplier: number;\n\trocketSeekDistance: number;\n\n\trocketSplashSize: number;\n\trocketSplashSizeMultiplier: number;\n\n\trocketSplashDmgFallOverDistance: number;\n\trocketSplashDmgFallDistanceValue: number;\n\n\tnrOfRockets: number;\n\trocketShards: number | undefined;\n\trocketShardsAmount: number;\n\n\tnrOfFollowers: number;\n\tfollowerBlasterDmg: number;\n\tfollowerBlasterDmgMultiplier: number;\n\tfollowerCanUseMissiles: number | undefined;\n}\n\nexport const player: Ship = {\n\tmaxHealth: 2,\n\tscorePerPickup: 1,\n\tblasterDmg: 2,\n\tblasterDmgMultiplier: 1,\n\tblasterLvl: undefined,\n\tblasterParallel: undefined,\n\trocketsLvl: undefined,\n\tnrOfRockets: 3,\n\trocketShards: undefined,\n\trocketShardsAmount: 3,\n\tblasterSpeedMultiplier: 1,\n\tdebreePickupDistance: 10,\n\tdebreeSeekDistance: 50,\n\tdebreeSeekSpeed: 80,\n\tdebreeSeekDistanceMultiplier: 1,\n\tdebreeSeekSpeedMultiplier: 1,\n\tdebreeValueMultiplier: 1,\n\trocketImpactDmg: 10,\n\trocketSplashDmg: 5,\n\trocketDmgMultiplier: 1,\n\trocketSplashSize: 30,\n\trocketSplashSizeMultiplier: 1,\n\trocketSplashDmgFallOverDistance: 0.7, // How much the splash dmg is reduced after distance met\n\trocketSplashDmgFallDistanceValue: 0.6,\n\trocketSeekDistance: 200,\n\tspeed: 100,\n\tcanSprint: undefined,\n\tsprintSpeedMultiplier: 1,\n\tspeedMultiplier: 1,\n\tspeedPwrUpMultiplier: 1,\n\tnrOfFollowers: 0,\n\tfollowerBlasterDmg: 1,\n\tfollowerBlasterDmgMultiplier: 1,\n\tfollowerCanUseMissiles: undefined,\n};\n\nexport function loadPlayer() {\n\tplayer.blasterLvl = getToolUpgradeLvlValue(\"blaster\");\n\tplayer.blasterParallel = getToolUpgradeLvlValue(\"blasterParallel\");\n\tplayer.blasterDmgMultiplier = getToolUpgradeLvlValue(\"blasterDmg\") ?? 1;\n\tplayer.blasterSpeedMultiplier = getToolUpgradeLvlValue(\"blasterSpeed\") ?? 1;\n\n\tplayer.rocketsLvl = getToolUpgradeLvlValue(\"rockets\");\n\tplayer.nrOfRockets = getToolUpgradeLvlValue(\"nrOfRockets\") ?? 3;\n\tplayer.rocketShards = getToolUpgradeLvlValue(\"rocketShards\");\n\tplayer.rocketShardsAmount = getToolUpgradeLvlValue(\"rocketShardsAmount\") ?? 3;\n\n\tplayer.debreeSeekDistanceMultiplier =\n\t\tgetToolUpgradeLvlValue(\"debreeDist\") ?? 1;\n\tplayer.debreeSeekSpeedMultiplier = getToolUpgradeLvlValue(\"debreeSpeed\") ?? 1;\n\tplayer.debreeValueMultiplier = getToolUpgradeLvlValue(\"debreeValue\") ?? 1;\n\n\tplayer.canSprint = getToolUpgradeLvlValue(\"sprint\");\n\tplayer.sprintSpeedMultiplier = getToolUpgradeLvlValue(\"sprintSpeed\") ?? 1;\n\n\tplayer.speedMultiplier = getToolUpgradeLvlValue(\"movespeed\") ?? 1;\n\tplayer.maxHealth = getToolUpgradeLvlValue(\"maxHealth\") ?? 2;\n\n\tplayer.nrOfFollowers = getToolUpgradeLvlValue(\"follower\") ?? 0;\n\tplayer.followerBlasterDmg = getToolUpgradeLvlValue(\"followerBlasterDmg\") ?? 1;\n\tplayer.followerCanUseMissiles = getToolUpgradeLvlValue(\"followerMissiles\");\n}\n\nexport function hasLvlValue(value: number | undefined, lvl: number) {\n\tif (value === undefined) return false;\n\n\treturn value >= lvl;\n}\n","import { GameObj, ParticlesComp, PosComp } from \"kaplay\";\nimport { k } from \"./main\";\n\nexport let trailEmitter: GameObj<PosComp | ParticlesComp>;\nexport let starsEmitter: GameObj<PosComp | ParticlesComp>;\nexport let starsEmitterDir: GameObj<PosComp | ParticlesComp>;\nexport let explosionEmitter: GameObj<PosComp | ParticlesComp>;\nexport let debreeEmitter: GameObj<PosComp | ParticlesComp>;\nexport let debreeRocketEmitter: GameObj<PosComp | ParticlesComp>;\nexport let dustTrailEmitter: GameObj<PosComp | ParticlesComp>;\nexport let sparkEmitter: GameObj<PosComp | ParticlesComp>;\n\nexport function initParticles() {\n\ttrailEmitter = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 2000,\n\t\t\t\tspeed: [2, 30],\n\t\t\t\tlifeTime: [0.2, 0.6],\n\t\t\t\tcolors: [k.WHITE],\n\t\t\t\topacities: [0.8, 0.6],\n\t\t\t\tangle: [0, 360],\n\t\t\t\tdamping: [2, 2],\n\t\t\t\tscales: [0.4, 0.2, 0.1],\n\t\t\t\ttexture: k.getSprite(\"particle3\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"particle3\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 1,\n\t\t\t\tdirection: 0,\n\t\t\t\tspread: 90,\n\t\t\t\tposition: k.vec2(0, 0),\n\t\t\t}\n\t\t),\n\t\t\"trail\",\n\t]);\n\n\tstarsEmitter = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 1000,\n\t\t\t\tspeed: [10, 40],\n\t\t\t\tangle: [0, 360],\n\t\t\t\tlifeTime: [1, 1.5],\n\t\t\t\tcolors: [k.rgb(255, 255, 255)],\n\t\t\t\topacities: [1, 0.5],\n\t\t\t\tscales: [1.4, 1, 0.4, 0.1],\n\t\t\t\tdamping: [0, 0.5],\n\t\t\t\tangularVelocity: [-90, 90],\n\t\t\t\ttexture: k.getSprite(\"particle1\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"particle1\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 0,\n\t\t\t\tdirection: -90,\n\t\t\t\tspread: 360,\n\t\t\t\tposition: k.vec2(),\n\t\t\t}\n\t\t),\n\t]);\n\n\tstarsEmitterDir = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 1000,\n\t\t\t\tspeed: [200, 300],\n\t\t\t\tangle: [0, 360],\n\t\t\t\tlifeTime: [1, 1.5],\n\t\t\t\tcolors: [k.rgb(255, 255, 255)],\n\t\t\t\topacities: [1, 0.5],\n\t\t\t\tscales: [1.4, 1, 0.4, 0.1],\n\t\t\t\tdamping: [0, 0.5],\n\t\t\t\tangularVelocity: [-90, 90],\n\t\t\t\ttexture: k.getSprite(\"particle1\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"particle1\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 0,\n\t\t\t\tdirection: -90,\n\t\t\t\tspread: 40,\n\t\t\t\tposition: k.vec2(),\n\t\t\t}\n\t\t),\n\t]);\n\n\tsparkEmitter = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 1000,\n\t\t\t\tspeed: [100, 150],\n\t\t\t\tlifeTime: [1, 1.5],\n\t\t\t\tangle: [0, 360],\n\t\t\t\tcolors: [k.rgb(255, 255, 255)],\n\t\t\t\topacities: [1, 0.5],\n\t\t\t\tdamping: [0, 0.5],\n\t\t\t\ttexture: k.getSprite(\"particle4\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"particle4\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 0,\n\t\t\t\tdirection: -90,\n\t\t\t\tspread: 40,\n\t\t\t\tposition: k.vec2(),\n\t\t\t}\n\t\t),\n\t]);\n\n\tdustTrailEmitter = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 1000,\n\t\t\t\tspeed: [10, 40],\n\t\t\t\tlifeTime: [1, 1.5],\n\t\t\t\tcolors: [k.rgb(255, 255, 255)],\n\t\t\t\topacities: [1, 0.5],\n\t\t\t\tscales: [1, 0.4, 0.1],\n\t\t\t\tacceleration: [k.vec2(0, 1), k.vec2(0, 2)],\n\t\t\t\tangularVelocity: [-90, 90],\n\t\t\t\ttexture: k.getSprite(\"particle1\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"particle1\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 0,\n\t\t\t\tdirection: -90,\n\t\t\t\tspread: 0,\n\t\t\t\tposition: k.vec2(),\n\t\t\t}\n\t\t),\n\t]);\n\n\tdebreeEmitter = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 1000,\n\t\t\t\tspeed: [5, 40],\n\t\t\t\tangle: [0, 360],\n\t\t\t\tlifeTime: [1, 2],\n\t\t\t\tcolors: [k.rgb(255, 255, 255)],\n\t\t\t\topacities: [0.7, 0.4],\n\t\t\t\tangularVelocity: [-90, 90],\n\t\t\t\tscales: [1, 0.8, 0],\n\t\t\t\ttexture: k.getSprite(\"debree_part1\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"debree_part1\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 0,\n\t\t\t\tdirection: -90,\n\t\t\t\tspread: 360,\n\t\t\t\tposition: k.vec2(),\n\t\t\t}\n\t\t),\n\t]);\n\n\tdebreeRocketEmitter = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 1000,\n\t\t\t\tspeed: [60, 80],\n\t\t\t\tangle: [0, 360],\n\t\t\t\tlifeTime: [1, 2],\n\t\t\t\tcolors: [k.rgb(255, 255, 255)],\n\t\t\t\tangularVelocity: [-90, 90],\n\t\t\t\tscales: [1, 0.8, 0.2, 0],\n\t\t\t\ttexture: k.getSprite(\"debree_part1\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"debree_part1\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 0,\n\t\t\t\tdirection: -90,\n\t\t\t\tspread: 55,\n\t\t\t\tposition: k.vec2(),\n\t\t\t}\n\t\t),\n\t]);\n\n\texplosionEmitter = k.add([\n\t\tk.pos(),\n\t\tk.particles(\n\t\t\t{\n\t\t\t\tmax: 1000,\n\t\t\t\tspeed: [30, 80],\n\t\t\t\tangle: [0, 360],\n\t\t\t\tlifeTime: [0.5, 1.2],\n\t\t\t\tcolors: [k.rgb(255, 255, 255)],\n\t\t\t\topacities: [0.8, 0.5],\n\t\t\t\tscales: [0.4, 2, 1.2, 0.4, 0.1],\n\t\t\t\tdamping: [1, 2],\n\t\t\t\ttexture: k.getSprite(\"particle3\")!.data!.tex,\n\t\t\t\tquads: [k.getSprite(\"particle3\")!.data!.frames[0]],\n\t\t\t},\n\t\t\t{\n\t\t\t\trate: 0,\n\t\t\t\tdirection: -90,\n\t\t\t\tspread: 360,\n\t\t\t\tposition: k.vec2(),\n\t\t\t}\n\t\t),\n\t]);\n}\n","import { k } from \"./main\";\n\nexport interface Level {\n\tmusic: string; // The songs that plays the whole level\n\tbpm: number;\n\tsongTitle: string;\n\tsongAuthor: string;\n\tsongAlbumCover: string;\n\ttitle: string; // Main title which introduces the level\n\tintroduceSound: string; // What sound is played when the level is introduced?\n\tlevelLengthSeconds: number;\n\twaves: Wave[]; // Used for spawning enemies\n\tlvlUpd: () => void;\n\treset: () => void;\n}\n\ninterface Wave {\n\ttimeStamp: number; // timestamp in milliseconds\n\tduration?: number; // Duration of wave in milliseconds\n\tupd: (levelDuration: number) => void;\n\tbegin?: (levelDuration: number) => void;\n}\n\nlet currentLvl: Level | null = null;\nlet nextWaveIndex = -1;\nlet currentWaveIndex = -1;\nlet firstWaveTriggered = false;\nlet timeDuringLevel = 0;\nexport function loadLevel(lvl: Level) {\n\tcurrentLvl = lvl;\n\tnextWaveIndex = 0;\n\tcurrentWaveIndex = -1;\n}\n\nexport function updateLvl() {\n\tif (!currentLvl) return false;\n\ttimeDuringLevel += k.dt() * 1000;\n\n\t// Level ended\n\tif (currentLvl.levelLengthSeconds < timeDuringLevel / 1000) {\n\t\treturn true;\n\t}\n\n\tif (nextWaveIndex < currentLvl.waves.length) {\n\t\tconst nextTimestamp = currentLvl.waves[nextWaveIndex].timeStamp;\n\n\t\t// Timestamp reached, begin wave\n\t\tif (nextTimestamp < timeDuringLevel && currentWaveIndex != nextWaveIndex) {\n\t\t\tcurrentWaveIndex = nextWaveIndex;\n\t\t\tnextWaveIndex++;\n\t\t\tif (currentLvl.waves[currentWaveIndex].begin) {\n\t\t\t\tcurrentLvl.waves[currentWaveIndex].begin!(timeDuringLevel);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (currentWaveIndex > 0 && currentWaveIndex < currentLvl.waves.length) {\n\t\tconst waveEndedTimestamp =\n\t\t\t(currentLvl.waves[currentWaveIndex].duration ?? 0) +\n\t\t\tcurrentLvl.waves[currentWaveIndex].timeStamp;\n\n\t\tif (timeDuringLevel < waveEndedTimestamp) {\n\t\t\tcurrentLvl.waves[currentWaveIndex].upd(\n\t\t\t\ttimeDuringLevel - currentLvl.waves[currentWaveIndex].timeStamp\n\t\t\t);\n\t\t\tcurrentLvl.lvlUpd();\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport function activeLevel() {\n\treturn currentLvl != null;\n}\n\nexport function resetCurrentLevel() {\n\tif (!currentLvl) return;\n\tresetLvlData(currentLvl);\n\tcurrentLvl = null;\n\ttimeDuringLevel = 0;\n}\nexport function resetLvlData(lvl: Level) {\n\tnextWaveIndex = -1;\n\tcurrentWaveIndex = -1;\n\tlvl.reset();\n\tfirstWaveTriggered = false;\n}\n","export const tags = {\n\tfriendly: \"friendly\",\n\tenemy: \"enemy\",\n\tgameLoopUi: \"game_loop_ui\",\n\n\tblaster: \"blaster\",\n\trocket: \"rocket\",\n\tdebree: \"debree\",\n\tunit: \"unit\",\n\tpart: \"part\",\n\n\tlevelBg: \"level_bg\",\n};\n","import { AnimateComp, GameObj, OpacityComp, RectComp } from \"kaplay\";\nimport { k } from \"./main\";\nimport { tags } from \"./tags\";\n\nlet healthBars: GameObj<OpacityComp>[] = [];\nlet specialBar: GameObj<RectComp> | null = null;\n\nconst height = 10;\nconst specialHeight = 80;\nexport function setupGameLoopUi(health: number) {\n\tfor (let i = 0; i < health; i++) {\n\t\tconst offset = height * (i + 1);\n\t\tconst c = k.add([\n\t\t\tk.pos(10, k.height() - offset),\n\t\t\tk.rect(10, 6),\n\t\t\tk.color(k.WHITE),\n\t\t\tk.opacity(1),\n\t\t\ttags.gameLoopUi,\n\t\t]);\n\n\t\thealthBars.push(c);\n\t}\n\n\tk.add([\n\t\tk.pos(22, k.height() - 4 - specialHeight),\n\t\tk.rect(4, specialHeight),\n\t\tk.color(k.WHITE),\n\t\tk.opacity(0.2),\n\t\ttags.gameLoopUi,\n\t]);\n\tspecialBar = k.add([\n\t\tk.pos(22, k.height() - 4 - specialHeight),\n\t\tk.rect(4, specialHeight),\n\t\tk.color(k.WHITE),\n\t\ttags.gameLoopUi,\n\t]);\n}\n\nexport function updatePlayerHealthBar(newHealth: number) {\n\tconst clamp = k.clamp(newHealth, 0, healthBars.length - 1);\n\tfor (let i = healthBars.length - 1; i > clamp; i--) {\n\t\thealthBars[i].opacity = 0.2;\n\t}\n}\n\nexport function updateSpecialBar(current: number, max: number) {\n\tspecialBar!.height = specialHeight * (current / max);\n}\n\nexport function clearGameLoopUi() {\n\tk.destroyAll(tags.gameLoopUi);\n\thealthBars = [];\n\tspecialBar = null;\n}\n","import { projectiles } from \"../game\";\nimport { BULLET_SPEED, k } from \"../main\";\n\nexport function shootBlaster(pos, dir, rot, dmg, speedMltp, tags) {\n\tconst p = k.add([\n\t\tk.pos(pos),\n\t\tk.move(dir, BULLET_SPEED * speedMltp),\n\t\tk.area(),\n\t\tk.rotate(rot),\n\t\tk.offscreen({ destroy: true }),\n\t\tk.anchor(\"center\"),\n\t\tk.sprite(\"bullet1\"),\n\t\t{\n\t\t\tdmg,\n\t\t},\n\t\t...tags,\n\t]);\n\n\tp.onDestroy(() => {\n\t\tconst index = projectiles.findIndex((p2) => p2.id == p.id);\n\n\t\tprojectiles.splice(index, 1);\n\t});\n\n\tk.play(\"shoot1\", { volume: 0.6 });\n\tprojectiles.push(p);\n}\n","import {\n\tAnimateComp,\n\tGameObj,\n\tOpacityComp,\n\tPosComp,\n\tRotateComp,\n\tScaleComp,\n\tVec2,\n} from \"kaplay\";\nimport { k } from \"./main\";\nimport { adjustedTarget } from \"./util\";\n\nexport function registerHitAnimation(m: GameObj<AnimateComp>) {\n\tm.animate(\"opacity\", [0, 1, 0, 1], {\n\t\tduration: 0.14,\n\t\tloops: 1,\n\t});\n}\n\nexport function lerpAngleBetweenPos(\n\tangle: number,\n\tpos1: Vec2,\n\tpos2: Vec2,\n\thardness: number,\n\taddAngle: number\n) {\n\tconst dir = pos1.sub(pos2).unit();\n\n\tconst a = Math.atan2(dir.y, dir.x);\n\n\tconst desiredRot = k.rad2deg(a) + addAngle;\n\tconst correctedDesiredRot = adjustedTarget(angle, desiredRot);\n\n\treturn { dir, lerp: k.lerp(angle, correctedDesiredRot, hardness) };\n}\n\nexport function lerpMoveRotateAndScale(\n\tm: GameObj<PosComp | RotateComp | ScaleComp | any>,\n\tlerp: number,\n\tspeed: number\n) {\n\tconst lerpAngle = k.deg2rad(lerp + 90);\n\tconst x = Math.cos(lerpAngle);\n\tconst y = Math.sin(lerpAngle);\n\tm.move(x * speed * -1, y * speed * -1);\n\tm.angle = lerp;\n\tm.scale = k.vec2(1, Math.abs(y));\n}\n","import { Vec2 } from \"kaplay\";\nimport { pickUnitInDistance, projectiles } from \"../game\";\nimport { k, ROCKET_SPEED } from \"../main\";\nimport { trailEmitter } from \"../particles\";\nimport { lerpAngleBetweenPos, lerpMoveRotateAndScale } from \"../shared\";\nimport { shootBlaster } from \"./blaster\";\nimport { tags } from \"../tags\";\nimport { player } from \"../player\";\n\nconst acquireTargetAfter = 0.5;\nconst trailOffset = 12;\nconst maxSpeed = 400;\nexport function shootRocket(\n\tpos,\n\tdir,\n\trot,\n\timpactDmg,\n\tsplashDmg,\n\tsplashSize,\n\tsplashDmgFallof,\n\tsplashDmgFallofDist,\n\tspeedMltp,\n\ttagsToAttach,\n\tcanSeek\n) {\n\tconst r = k.add([\n\t\tk.pos(pos),\n\t\tk.area(),\n\t\tk.rotate(rot),\n\t\tk.offscreen({ destroy: true }),\n\t\tk.anchor(\"center\"),\n\t\tk.scale(1),\n\t\tk.sprite(\"rocket1\"),\n\t\t{\n\t\t\timpactDmg,\n\t\t\tsplashDmg,\n\t\t\tsplashSize,\n\t\t\tsplashDmgFallof,\n\t\t\tsplashDmgFallofDist,\n\t\t\tlifetime: 0,\n\t\t\tspeedMltp,\n\t\t\tdir,\n\t\t\ttargetUnit: null,\n\t\t\tcanSeek,\n\t\t},\n\t\t...tagsToAttach,\n\t]);\n\n\tk.play(\"fire_rocket1\", { volume: 0.4 });\n\n\tr.onUpdate(() => {\n\t\tr.lifetime += k.dt();\n\n\t\tconst speed = k.clamp(\n\t\t\tROCKET_SPEED * r.speedMltp * (0.3 + r.lifetime),\n\t\t\t0,\n\t\t\tmaxSpeed\n\t\t);\n\n\t\tconst currentDir = k.Vec2.fromAngle(r.angle - 90);\n\t\tif (r.targetUnit) {\n\t\t\tconst { lerp, dir } = lerpAngleBetweenPos(\n\t\t\t\tr.angle,\n\t\t\t\tr.pos,\n\t\t\t\tr.targetUnit.pos,\n\t\t\t\t0.04,\n\t\t\t\t-90\n\t\t\t);\n\t\t\tlerpMoveRotateAndScale(r, lerp, speed);\n\t\t} else {\n\t\t\tr.move(currentDir.x * speed, currentDir.y * speed);\n\t\t}\n\n\t\tconst emitterPos = k.vec2(\n\t\t\tr.pos.x - trailOffset * currentDir.x,\n\t\t\tr.pos.y - trailOffset * currentDir.y\n\t\t);\n\t\ttrailEmitter.emitter.position = emitterPos;\n\t\ttrailEmitter.emitter.direction = r.angle;\n\t\ttrailEmitter.emit(1);\n\n\t\tif (r.canSeek && r.lifetime > acquireTargetAfter && r.targetUnit == null) {\n\t\t\tpickUnitInDistance(r.pos, 200, \"enemy\", (u) => {\n\t\t\t\tr.targetUnit = u;\n\n\t\t\t\tr.targetUnit?.onDestroy(() => {\n\t\t\t\t\tr.targetUnit = null;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\tr.onDestroy(() => {\n\t\tconst index = projectiles.findIndex((p2) => p2.id == r.id);\n\n\t\tprojectiles.splice(index, 1);\n\n\t\tif (player.rocketShards !== undefined) {\n\t\t\tconst shards = player.rocketShardsAmount;\n\t\t\tfor (let i = 0; i < shards; i++) {\n\t\t\t\tconst angle = 360 * (i / shards);\n\t\t\t\tshootBlaster(r.pos, k.Vec2.fromAngle(angle), angle + 90, 1, 1, [\n\t\t\t\t\ttags.friendly,\n\t\t\t\t\ttags.blaster,\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n\n\tprojectiles.push(r);\n}\n","import {\n\tcheckProjectileIntersection,\n\tclearGame,\n\tcreateExplosion,\n} from \"./game\";\nimport { updatePlayerHealthBar, updateSpecialBar } from \"./gameUi\";\nimport { k } from \"./main\";\nimport { starsEmitter, trailEmitter } from \"./particles\";\nimport { hasLvlValue, player } from \"./player\";\nimport { shootBlaster } from \"./projectiles/blaster\";\nimport { shootRocket } from \"./projectiles/rocket\";\nimport {\n\tlerpAngleBetweenPos,\n\tlerpMoveRotateAndScale,\n\tregisterHitAnimation,\n} from \"./shared\";\nimport { tags } from \"./tags\";\nimport { randomExplosion } from \"./util\";\n\nlet blasters = 0;\nlet bulletIndex = 1;\nlet specialTimer = 0;\nconst rocketSpecialCooldown = 6;\nexport function setupPlayer() {\n\tconst playerObj = k.add([\n\t\tk.pos(k.center()),\n\t\tk.sprite(\"ship\"),\n\t\tk.rotate(0),\n\t\tk.scale(),\n\t\tk.health(player.maxHealth),\n\t\tk.area(),\n\t\tk.anchor(\"center\"),\n\t\tk.animate(),\n\t\ttags.friendly,\n\t]);\n\n\tregisterHitAnimation(playerObj);\n\n\tif (hasLvlValue(player.blasterLvl, 1)) {\n\t\tplayerObj.add([k.anchor(\"center\"), k.pos(10, 0)]);\n\t\tblasters++;\n\t}\n\tif (hasLvlValue(player.blasterLvl, 2)) {\n\t\tplayerObj.add([k.anchor(\"center\"), k.pos(-10, 0)]);\n\t\tblasters++;\n\t}\n\tif (hasLvlValue(player.blasterLvl, 3)) {\n\t\tplayerObj.add([k.anchor(\"center\"), k.pos(0, -6)]);\n\t\tblasters++;\n\t}\n\n\tplayerObj.onDeath(() => {\n\t\tk.destroy(playerObj);\n\t\tstarsEmitter.emitter.position = playerObj.pos;\n\t\tstarsEmitter.emit(20);\n\t\tk.play(\"explosion1\", { volume: 1 });\n\t\tclearGame();\n\t});\n\n\tplayerObj.onUpdate(() => {\n\t\tif (specialTimer < rocketSpecialCooldown) {\n\t\t\tspecialTimer += k.dt();\n\t\t\tupdateSpecialBar(specialTimer, rocketSpecialCooldown);\n\t\t}\n\n\t\tcheckProjectileIntersection(playerObj.pos, 12, tags.enemy, (p) => {\n\t\t\tk.destroy(p);\n\t\t\tif (p.tags.includes(tags.blaster)) {\n\t\t\t\tplayerObj.hurt(p.dmg);\n\t\t\t} else if (p.tags.includes(tags.rocket)) {\n\t\t\t\tplayerObj.hurt(p.impactDmg);\n\t\t\t\tcreateExplosion(\n\t\t\t\t\tp.pos,\n\t\t\t\t\tp.splashSize,\n\t\t\t\t\tp.splashDmg,\n\t\t\t\t\tp.splashDmgFallof,\n\t\t\t\t\tp.splashDmgFallofDist\n\t\t\t\t);\n\t\t\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\t\t\tk.shake(3);\n\t\t\t}\n\t\t});\n\n\t\t// If rockets have a target for too long, find new target\n\t\tconst dist = playerObj.pos.dist(k.mousePos()) - 12;\n\t\tconst { dir, lerp } = lerpAngleBetweenPos(\n\t\t\tplayerObj.angle,\n\t\t\tplayerObj.pos,\n\t\t\tk.mousePos(),\n\t\t\t0.05,\n\t\t\t-90\n\t\t);\n\n\t\tconst maxSpeed =\n\t\t\tplayer.speed * player.speedMultiplier * player.speedPwrUpMultiplier;\n\t\tconst speed = k.clamp(dist * 4, 0, maxSpeed);\n\n\t\tplayerObj.angle = lerp;\n\n\t\tconst playerCurrentDir = k.Vec2.fromAngle(playerObj.angle + 90);\n\t\tconst emitterPos = k.vec2(\n\t\t\tplayerObj.pos.x + 12 * playerCurrentDir.x,\n\t\t\tplayerObj.pos.y + 12 * playerCurrentDir.y\n\t\t);\n\n\t\tif (speed > 4) {\n\t\t\ttrailEmitter.emitter.position = emitterPos;\n\t\t\ttrailEmitter.emitter.direction = k.Vec2.toAngle(dir);\n\t\t\ttrailEmitter.emit(1);\n\t\t}\n\n\t\tlerpMoveRotateAndScale(playerObj, lerp, speed);\n\t});\n\n\tplayerObj.onHurt(() => {\n\t\tk.play(\"hit2\", { volume: 0.4 });\n\t\tplayerObj.animation.seek(0);\n\t\tk.shake(20);\n\t\tk.flash(k.RED, 0.4);\n\t\tupdatePlayerHealthBar(playerObj.hp());\n\t});\n\n\tplayerObj.onMousePress(\"left\", () => {\n\t\tif (hasLvlValue(player.blasterLvl, 1)) {\n\t\t\tif (hasLvlValue(player.blasterParallel, 1)) {\n\t\t\t\tfor (let i = 0; i < blasters; i++) {\n\t\t\t\t\tconst gunPipe = playerObj.children[i];\n\t\t\t\t\tshootBlaster(\n\t\t\t\t\t\tgunPipe.worldPos(),\n\t\t\t\t\t\tk.Vec2.fromAngle(playerObj.angle - 90),\n\t\t\t\t\t\tplayerObj.angle,\n\t\t\t\t\t\tplayer.blasterDmg * player.blasterDmgMultiplier,\n\t\t\t\t\t\tplayer.blasterSpeedMultiplier,\n\t\t\t\t\t\t[tags.friendly, tags.blaster]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst gunPipe = playerObj.children[bulletIndex % blasters];\n\t\t\tshootBlaster(\n\t\t\t\tgunPipe.worldPos(),\n\t\t\t\tk.Vec2.fromAngle(playerObj.angle - 90),\n\t\t\t\tplayerObj.angle,\n\t\t\t\tplayer.blasterDmg * player.blasterDmgMultiplier,\n\t\t\t\tplayer.blasterSpeedMultiplier,\n\t\t\t\t[tags.friendly, tags.blaster]\n\t\t\t);\n\t\t\tbulletIndex++;\n\t\t}\n\t});\n\n\tplayerObj.onMousePress(\"right\", () => {\n\t\tif (player.rocketsLvl === undefined) return;\n\n\t\tif (specialTimer < rocketSpecialCooldown) {\n\t\t\treturn;\n\t\t}\n\n\t\tspecialTimer = 0;\n\t\tk.loop(\n\t\t\t0.1,\n\t\t\t() => {\n\t\t\t\tshootRocket(\n\t\t\t\t\tplayerObj.pos,\n\t\t\t\t\tk.Vec2.fromAngle(playerObj.angle - 90),\n\t\t\t\t\tplayerObj.angle,\n\t\t\t\t\tplayer.rocketImpactDmg * player.rocketDmgMultiplier,\n\t\t\t\t\tplayer.rocketSplashDmg * player.rocketDmgMultiplier,\n\t\t\t\t\tplayer.rocketSplashSize * player.rocketSplashSizeMultiplier,\n\t\t\t\t\tplayer.rocketSplashDmgFallDistanceValue,\n\t\t\t\t\tplayer.rocketSplashDmgFallOverDistance,\n\t\t\t\t\t1,\n\t\t\t\t\t[tags.friendly, tags.rocket],\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t},\n\t\t\tplayer.nrOfRockets\n\t\t);\n\t});\n\n\tplayerObj.onKeyDown(\"shift\", () => {\n\t\tif (player.canSprint === undefined) return;\n\t\tplayer.speedPwrUpMultiplier = 1.8 * player.sprintSpeedMultiplier;\n\t});\n\tplayerObj.onKeyRelease(\"shift\", () => {\n\t\tplayer.speedPwrUpMultiplier = 1;\n\t});\n\n\treturn playerObj;\n}\n\nexport function clearPlayer() {\n\tbulletIndex = 0;\n\tblasters = 0;\n}\n","import { debrees } from \"../game\";\nimport { k } from \"../main\";\nimport { tags } from \"../tags\";\n\nexport function spawnDebree(pos, am) {\n\tfor (let i = 0; i < am; i++) {\n\t\tconst d = k.add([\n\t\t\tk.pos(pos),\n\t\t\tk.sprite(\"particle2\"),\n\t\t\tk.animate({ relative: true }),\n\t\t\tk.rotate(k.rand(360)),\n\t\t\tk.opacity(1),\n\t\t\t{\n\t\t\t\tdir: k.rand(k.vec2(-1, -1), k.vec2(1, 1)),\n\t\t\t\tspeed: k.rand(40, 60),\n\t\t\t\tlifeSpan: 0,\n\t\t\t},\n\t\t\ttags.debree,\n\t\t]);\n\n\t\td.onUpdate(() => {\n\t\t\tif (d.lifeSpan > d.speed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\td.move(\n\t\t\t\td.dir.x * (d.speed - d.lifeSpan),\n\t\t\t\td.dir.y * (d.speed - d.lifeSpan)\n\t\t\t);\n\n\t\t\td.lifeSpan += k.dt() * 45;\n\t\t});\n\n\t\td.animate(\"opacity\", [1, 0.5], {\n\t\t\tduration: 1,\n\t\t});\n\n\t\tdebrees.push(d);\n\t}\n}\n","import {\n\tcheckProjectileIntersection,\n\tclearGame,\n\tcreateExplosion,\n\tplayerObj,\n} from \"../game\";\nimport { k } from \"../main\";\nimport { starsEmitter } from \"../particles\";\nimport { shootBlaster } from \"../projectiles/blaster\";\nimport {\n\tlerpAngleBetweenPos,\n\tlerpMoveRotateAndScale,\n\tregisterHitAnimation,\n} from \"../shared\";\nimport { tags } from \"../tags\";\nimport { randomExplosion } from \"../util\";\nimport { spawnDebree } from \"./spawnDebree\";\n\nexport function spawnAssasin(pos, am, hp, scale) {\n\tconst hb = 12 * scale;\n\tconst m = k.add([\n\t\tk.pos(pos),\n\t\tk.sprite(\"enemy_ship1\"),\n\t\tk.rotate(0),\n\t\tk.anchor(\"center\"),\n\t\tk.health(hp),\n\t\tk.animate(),\n\t\tk.scale(scale),\n\t\tk.offscreen({ destroy: true }),\n\t\t{\n\t\t\tspeed: k.rand(100, 130),\n\t\t\thb,\n\t\t\ttargetPos: k.rand(k.vec2(k.width(), k.height())),\n\t\t},\n\t\tk.state(\"retreat\", [\"attack\", \"retreat\"]),\n\t\ttags.enemy,\n\t\ttags.unit,\n\t]);\n\n\tm.onStateEnter(\"retreat\", async () => {\n\t\tconst pos = k.rand(k.vec2(k.width(), k.height()));\n\t\tm.targetPos = pos;\n\t\tawait k.wait(1);\n\t\tm.enterState(\"attack\");\n\t});\n\n\tm.onStateEnter(\"attack\", async () => {\n\t\tawait k.wait(3);\n\t\tm.enterState(\"retreat\");\n\t});\n\n\tm.onStateUpdate(\"attack\", () => {\n\t\tconst pos = playerObj.pos;\n\t\tm.targetPos = pos;\n\n\t\tconst dist = m.pos.dist(m.targetPos);\n\n\t\tif (dist < 50) {\n\t\t\tm.enterState(\"retreat\");\n\t\t} else if (dist > 50 && dist < 200) {\n\t\t\tif (Math.floor(k.rand(0, 200)) == 1) {\n\t\t\t\tshootBlaster(m.pos, k.Vec2.fromAngle(m.angle - 90), m.angle, 2, 1, [\n\t\t\t\t\ttags.enemy,\n\t\t\t\t\ttags.blaster,\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterHitAnimation(m);\n\n\tm.onUpdate(() => {\n\t\tconst { lerp } = lerpAngleBetweenPos(\n\t\t\tm.angle,\n\t\t\tm.pos,\n\t\t\tm.targetPos,\n\t\t\t0.01,\n\t\t\t-90\n\t\t);\n\n\t\tlerpMoveRotateAndScale(m, lerp, m.speed);\n\n\t\tcheckProjectileIntersection(m.pos, m.hb, tags.friendly, (p) => {\n\t\t\tk.destroy(p);\n\n\t\t\tif (p.tags.includes(tags.blaster)) {\n\t\t\t\tm.hurt(p.dmg);\n\t\t\t} else if (p.tags.includes(tags.rocket)) {\n\t\t\t\tm.hurt(p.impactDmg);\n\t\t\t\tcreateExplosion(\n\t\t\t\t\tp.pos,\n\t\t\t\t\tp.splashSize,\n\t\t\t\t\tp.splashDmg,\n\t\t\t\t\tp.splashDmgFallof,\n\t\t\t\t\tp.splashDmgFallofDist\n\t\t\t\t);\n\t\t\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\t\t\tk.shake(3);\n\t\t\t}\n\t\t});\n\t});\n\n\tm.onDeath(() => {\n\t\tstarsEmitter.emitter.position = m.pos;\n\t\tstarsEmitter.emit(20);\n\t\tspawnDebree(m.pos, am);\n\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\tk.destroy(m);\n\t});\n\n\tm.onHurt(() => {\n\t\tk.play(\"hit1\", { volume: 0.6 });\n\t\tm.animation.seek(0);\n\t});\n}\n","import { Vec2 } from \"kaplay\";\nimport {\n\tcheckProjectileIntersection,\n\tclearGame,\n\tcreateExplosion,\n\tplayerObj,\n} from \"../game\";\nimport { k } from \"../main\";\nimport { debreeRocketEmitter, sparkEmitter, starsEmitter } from \"../particles\";\nimport { registerHitAnimation } from \"../shared\";\nimport { tags } from \"../tags\";\nimport { randomExplosion } from \"../util\";\nimport { spawnDebree } from \"./spawnDebree\";\n\ninterface Props {\n\tpos: Vec2;\n\tdir: Vec2;\n\tscoreOnKill: number;\n\thp: number;\n\tspeed: number;\n\tsplitOnDeath: number;\n}\n\nexport function spawnMeteorite(props: Props) {\n\tconst initScale = k.rand(1, 2);\n\tconst hb = 12 * initScale;\n\tconst m = k.add([\n\t\tk.pos(props.pos),\n\t\tk.sprite(\"asteroid1\"),\n\t\tk.rotate(0),\n\t\tk.anchor(\"center\"),\n\t\tk.scale(k.rand(1, 2)),\n\t\tk.health(props.hp),\n\t\tk.animate(),\n\t\tk.offscreen({ destroy: true }),\n\t\t{\n\t\t\tvel: props.dir,\n\t\t\trotVel: k.rand(-4, 4),\n\t\t\tspeed: props.speed,\n\t\t\tinitScale,\n\t\t\thb,\n\t\t},\n\t\ttags.enemy,\n\t\ttags.unit,\n\t]);\n\n\tregisterHitAnimation(m);\n\n\tm.onUpdate(() => {\n\t\tm.move(m.vel.scale(m.speed));\n\t\tm.angle += m.rotVel;\n\n\t\tcheckProjectileIntersection(m.pos, m.hb, tags.friendly, (p) => {\n\t\t\tk.destroy(p);\n\n\t\t\tif (p.tags.includes(tags.blaster)) {\n\t\t\t\tm.hurt(p.dmg);\n\t\t\t\tspawnDebree(m.pos, 1);\n\t\t\t} else if (p.tags.includes(tags.rocket)) {\n\t\t\t\tm.hurt(p.impactDmg);\n\t\t\t\tcreateExplosion(\n\t\t\t\t\tp.pos,\n\t\t\t\t\tp.splashSize,\n\t\t\t\t\tp.splashDmg,\n\t\t\t\t\tp.splashDmgFallof,\n\t\t\t\t\tp.splashDmgFallofDist\n\t\t\t\t);\n\t\t\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\t\t\tk.shake(3);\n\t\t\t\tdebreeRocketEmitter.emitter.position = m.pos;\n\t\t\t\tdebreeRocketEmitter.emitter.direction = p.angle - 90;\n\t\t\t\tdebreeRocketEmitter.emit(6);\n\t\t\t}\n\t\t});\n\n\t\tif (playerObj.pos.dist(m.pos) < m.hb) {\n\t\t\tplayerObj.hurt(1);\n\t\t\tm.hurt(props.hp);\n\t\t}\n\t});\n\n\tm.onDeath(() => {\n\t\tstarsEmitter.emitter.position = m.pos;\n\t\tstarsEmitter.emit(20);\n\t\tspawnDebree(m.pos, props.scoreOnKill);\n\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\tk.destroy(m);\n\n\t\tif (props.splitOnDeath) {\n\t\t\tfor (let i = 0; i < props.splitOnDeath; i++) {\n\t\t\t\tspawnMeteorite({\n\t\t\t\t\tpos: m.pos,\n\t\t\t\t\tdir: k.rand(k.vec2(-1, -1), k.vec2(1, 1)),\n\t\t\t\t\tscoreOnKill: props.scoreOnKill / 2,\n\t\t\t\t\thp: props.hp / 2,\n\t\t\t\t\tspeed: props.speed * 2,\n\t\t\t\t\tsplitOnDeath: 0,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tm.onHurt(() => {\n\t\tk.play(\"hit1\", { volume: 0.6 });\n\t\tm.animation.seek(0);\n\t});\n}\n","import { GameObj, Vec2 } from \"kaplay\";\nimport {\n\tcheckProjectileIntersection,\n\tcreateExplosion,\n\tplayerObj,\n} from \"../game\";\nimport { k } from \"../main\";\nimport { starsEmitterDir } from \"../particles\";\nimport { tags } from \"../tags\";\nimport { randomExplosion } from \"../util\";\nimport { spawnDebree } from \"./spawnDebree\";\nimport { registerHitAnimation } from \"../shared\";\n\nexport function spawnGenericVehicle(\n\taddTo: GameObj<{ killed: number }>,\n\tpos: Vec2,\n\tdir: Vec2,\n\thp,\n\tsprite\n) {\n\tconst hb = 12;\n\tconst m = k.add([\n\t\tk.pos(pos),\n\t\tk.sprite(sprite),\n\t\tk.rotate(dir.angle() - 90),\n\t\tk.anchor(\"center\"),\n\t\tk.health(hp),\n\t\tk.animate(),\n\t\tk.offscreen({ destroy: true }),\n\t\t{\n\t\t\tvel: dir,\n\t\t\tspeed: k.rand(300, 340),\n\t\t\thb,\n\t\t},\n\t\ttags.enemy,\n\t\ttags.unit,\n\t]);\n\n\tregisterHitAnimation(m);\n\n\tm.onUpdate(() => {\n\t\tm.move(m.vel.scale(m.speed));\n\n\t\tcheckProjectileIntersection(m.pos, m.hb, tags.friendly, (p) => {\n\t\t\tk.destroy(p);\n\n\t\t\tif (p.tags.includes(tags.blaster)) {\n\t\t\t\tm.hurt(p.dmg);\n\t\t\t\tspawnDebree(m.pos, 1);\n\t\t\t} else if (p.tags.includes(tags.rocket)) {\n\t\t\t\tm.hurt(p.impactDmg);\n\t\t\t\tcreateExplosion(\n\t\t\t\t\tp.pos,\n\t\t\t\t\tp.splashSize,\n\t\t\t\t\tp.splashDmg,\n\t\t\t\t\tp.splashDmgFallof,\n\t\t\t\t\tp.splashDmgFallofDist\n\t\t\t\t);\n\t\t\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\t\t\tk.shake(3);\n\t\t\t}\n\t\t});\n\n\t\tif (playerObj.pos.dist(m.pos) < m.hb) {\n\t\t\tplayerObj.hurt(1);\n\t\t\tm.hurt(hp);\n\t\t}\n\t});\n\n\tm.onDeath(() => {\n\t\tstarsEmitterDir.emitter.position = m.pos;\n\t\tstarsEmitterDir.emitter.direction = m.angle + 90;\n\n\t\tstarsEmitterDir.emit(20);\n\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\tk.destroy(m);\n\n\t\taddTo.killed += 1;\n\t});\n\n\tm.onHurt(() => {\n\t\tk.play(\"hit1\", { volume: 0.6 });\n\t\tm.animation.seek(0);\n\t});\n}\n","import { Vec2 } from \"kaplay\";\nimport { k, timeSeconds } from \"../main\";\nimport { tags } from \"../tags\";\nimport { spawnGenericVehicle } from \"./spawnGenericVehicle\";\n\nexport function spawnHighway(startPos: Vec2, endPos: Vec2, intensity) {\n\tconst m = k.add([\n\t\tk.animate(),\n\t\t{\n\t\t\tstartPos,\n\t\t\tendPos,\n\t\t\topacity: 0.15,\n\t\t\tkilled: 0,\n\t\t},\n\t\ttags.enemy,\n\t]);\n\n\tm.onUpdate(() => {\n\t\tif (Math.floor(k.rand(0, 100 - intensity)) == 1) {\n\t\t\tconst offset = smallOffset(6);\n\t\t\tspawnGenericVehicle(\n\t\t\t\tm,\n\t\t\t\tm.startPos.add(offset),\n\t\t\t\tm.endPos.add(offset).sub(m.startPos).unit(),\n\t\t\t\t4,\n\t\t\t\trandomVehicle()\n\t\t\t);\n\t\t}\n\n\t\tm.opacity = k.wave(0.1, 0.2, k.time());\n\n\t\tif (m.killed >= 5) {\n\t\t\tm.destroy();\n\t\t}\n\t});\n\n\tm.onDraw(() => {\n\t\tk.drawLines({\n\t\t\tpts: [m.startPos, m.endPos],\n\t\t\twidth: 40,\n\t\t\topacity: m.opacity,\n\t\t});\n\t});\n}\n\nconst sprites = [\"enemy_ship1\", \"bike1\"];\nfunction randomVehicle() {\n\treturn sprites[Math.floor(k.rand(0, sprites.length))];\n}\n\nfunction smallOffset(offset) {\n\treturn k.rand(k.vec2(-offset, -offset), k.vec2(offset, offset));\n}\n","import {\n\tAnimateComp,\n\tGameObj,\n\tHealthComp,\n\tPosComp,\n\tSpriteComp,\n\tVec2,\n} from \"kaplay\";\nimport { k } from \"./main\";\nimport { registerHitAnimation } from \"./shared\";\nimport { starsEmitter } from \"./particles\";\nimport { spawnDebree } from \"./spawn/spawnDebree\";\nimport { randomExplosion } from \"./util\";\nimport { unitComponents } from \"./spawn/spawnShip1\";\nimport { JitterComp } from \"./comp/jitter\";\n\ninterface Part {\n\tobj: GameObj<HealthComp | AnimateComp | PosComp | SpriteComp | JitterComp>;\n\thitbox: number;\n\tisBody: boolean;\n\tscoreOnDestroy: number;\n}\n\ninterface Compose {\n\tparts: Part[];\n}\n\nexport interface Component {\n\tobj: GameObj<HealthComp | JitterComp>;\n\tlocalPos: Vec2;\n\thitbox: number;\n\tisBody: boolean;\n}\n\nexport function compose(c: Compose): Component[] {\n\tconst composed: Component[] = [];\n\tconst body = c.parts.find((x) => x.isBody);\n\n\tfor (let i = 0; i < c.parts.length; i++) {\n\t\tconst part = c.parts[i];\n\t\tregisterHitAnimation(part.obj);\n\n\t\tpart.obj.onHurt(() => {\n\t\t\tk.play(\"hit1\", { volume: 0.6 });\n\t\t\tc.parts[i].obj.animation.seek(0);\n\t\t});\n\n\t\tpart.obj.onDeath(() => {\n\t\t\tconst pos = part.isBody ? part.obj.pos : body!.obj.pos.sub(part.obj.pos);\n\t\t\tstarsEmitter.emitter.position = pos;\n\t\t\tstarsEmitter.emit(20);\n\t\t\tspawnDebree(pos, part.scoreOnDestroy);\n\t\t\tk.play(randomExplosion(), { volume: 0.6 });\n\n\t\t\tif (part.isBody) {\n\t\t\t\tdelete unitComponents[part.obj.id!];\n\t\t\t\tk.destroy(part.obj);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpart.obj.hidden = true;\n\t\t\tpart.obj.paused = true;\n\t\t\tdetach(pos, part.obj.sprite, k.rand(40, 80));\n\t\t\tbody!.obj.jitter(20);\n\t\t});\n\n\t\tcomposed.push({\n\t\t\tobj: part.obj,\n\t\t\tlocalPos: part.isBody ? k.vec2(0, 0) : part.obj.pos,\n\t\t\thitbox: part.hitbox,\n\t\t\tisBody: part.isBody,\n\t\t});\n\t}\n\n\treturn composed;\n}\n\nexport function detach(pos: Vec2, sprite: string, force: number) {\n\tconst p = k.add([\n\t\tk.pos(pos),\n\t\tk.sprite(sprite),\n\t\tk.lifespan(2, {\n\t\t\tfade: 0.2,\n\t\t}),\n\t\tk.offscreen({ destroy: true }),\n\t\tk.opacity(1),\n\t\tk.scale(1),\n\t\tk.rotate(k.rand(0, 360)),\n\t\tk.move(k.rand(k.vec2(-1, -1), k.vec2(1, 1)), force),\n\t\t{\n\t\t\tspin: k.rand(2, 8),\n\t\t},\n\t]);\n\n\tp.onUpdate(() => {\n\t\tconst v = k.wave(-1, 1, k.time() * p.spin);\n\t\tp.scale = k.vec2(v, v);\n\t});\n}\n","import { Comp } from \"kaplay\";\nimport { k } from \"../main\";\n\nexport interface JitterComp extends Comp {\n\tjitterValue: number;\n\tjitter: (value: number) => void;\n}\n\nexport function jitter(): JitterComp {\n\treturn {\n\t\tjitterValue: 0,\n\t\tid: \"jitter\",\n\t\trequire: [\"pos\"],\n\t\tupdate() {\n\t\t\tif (this.jitterValue > 0) {\n\t\t\t\tconst strength = this.jitterValue * 8;\n\t\t\t\tvar toJitter = k.rand(\n\t\t\t\t\tk.vec2(-strength, -strength),\n\t\t\t\t\tk.vec2(strength, strength)\n\t\t\t\t);\n\t\t\t\tthis.move(toJitter);\n\t\t\t\tthis.jitterValue -= k.dt() * 100;\n\t\t\t}\n\t\t},\n\t\tjitter(value: number) {\n\t\t\tthis.jitterValue = value;\n\t\t},\n\t};\n}\n","import { Vec2 } from \"kaplay\";\nimport { checkProjectileComponentIntersection, createExplosion } from \"../game\";\nimport { k } from \"../main\";\nimport { trailEmitter } from \"../particles\";\nimport { shootBlaster } from \"../projectiles/blaster\";\nimport { tags } from \"../tags\";\nimport { randomExplosion } from \"../util\";\n\nconst components = {\n\tbody: 1,\n\tleftWing: 2,\n\trightWing: 3,\n\tblaster: 4,\n};\nimport { Component, compose } from \"../compose\";\nimport { jitter } from \"../comp/jitter\";\n\nconst wingOffset = [6, 2];\nexport const unitComponents: Record<number, Component[]> = {};\n\nexport function spawnShip1(pos, dir: Vec2, am, hp, scale, speed) {\n\tconst hb = 16 * scale;\n\tconst m = k.add([\n\t\tk.pos(pos),\n\t\tk.sprite(\"enemy_ship1_body\"),\n\t\tk.rotate(dir.angle() + 90),\n\t\tk.anchor(\"center\"),\n\t\tk.health(hp),\n\t\tk.animate(),\n\t\tk.scale(scale),\n\t\tjitter(),\n\t\tk.offscreen({ destroy: true }),\n\t\t{\n\t\t\tvel: dir,\n\t\t\tspeed: speed,\n\t\t\thb,\n\t\t},\n\t\ttags.enemy,\n\t\ttags.unit,\n\t]);\n\n\tconst wing1 = m.add([\n\t\tk.pos(k.vec2(-wingOffset[0], -wingOffset[1])),\n\t\tk.sprite(\"enemy_ship1_left_wing\"),\n\t\tk.anchor(\"center\"),\n\t\tk.health(Math.floor(hp / 2)),\n\t\tk.animate(),\n\t\tjitter(),\n\t\ttags.part,\n\t]);\n\tconst wing2 = m.add([\n\t\tk.pos(k.vec2(wingOffset[0], -wingOffset[1])),\n\t\tk.sprite(\"enemy_ship1_right_wing\"),\n\t\tk.anchor(\"center\"),\n\t\tk.health(Math.floor(hp / 2)),\n\t\tk.animate(),\n\t\tjitter(),\n\t\ttags.part,\n\t]);\n\n\tunitComponents[m.id!] = compose({\n\t\tparts: [\n\t\t\t{ obj: m, hitbox: 8, isBody: true, scoreOnDestroy: am },\n\t\t\t{ obj: wing1, hitbox: 8, isBody: false, scoreOnDestroy: 2 },\n\t\t\t{ obj: wing2, hitbox: 8, isBody: false, scoreOnDestroy: 2 },\n\t\t],\n\t});\n\n\tm.onUpdate(() => {\n\t\tm.move(m.vel.scale(m.speed));\n\n\t\tcheckProjectileComponentIntersection(\n\t\t\tm.pos,\n\t\t\tm.hb,\n\t\t\ttags.friendly,\n\t\t\tunitComponents[m.id!],\n\t\t\t(p, i) => {\n\t\t\t\tk.destroy(p);\n\n\t\t\t\tif (p.tags.includes(tags.blaster)) {\n\t\t\t\t\tunitComponents[m.id!][i].obj.hurt(p.dmg);\n\t\t\t\t} else if (p.tags.includes(tags.rocket)) {\n\t\t\t\t\tunitComponents[m.id!][i].obj.hurt(p.impactDmg);\n\t\t\t\t\tcreateExplosion(\n\t\t\t\t\t\tp.pos,\n\t\t\t\t\t\tp.splashSize,\n\t\t\t\t\t\tp.splashDmg,\n\t\t\t\t\t\tp.splashDmgFallof,\n\t\t\t\t\t\tp.splashDmgFallofDist\n\t\t\t\t\t);\n\t\t\t\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\t\t\t\tk.shake(3);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tif (Math.floor(k.rand(0, 500)) == 10) {\n\t\t\tshootBlaster(m.pos, k.Vec2.fromAngle(m.angle - 90), m.angle, 2, 1, [\n\t\t\t\ttags.enemy,\n\t\t\t\ttags.blaster,\n\t\t\t]);\n\t\t}\n\n\t\tconst dir = k.Vec2.fromAngle(m.angle - 90);\n\t\tconst emitterPos = k.vec2(m.pos.x - 12 * dir.x, m.pos.y - 12 * dir.y);\n\t\ttrailEmitter.emitter.position = emitterPos;\n\t\ttrailEmitter.emitter.direction = k.Vec2.toAngle(dir);\n\t\ttrailEmitter.emit(1);\n\t});\n}\n","export function loadSongData(title: string, author: string, albumSrc: string) {\n\tconst container = document.getElementById(\"song\");\n\n\tconst titleEl = document.getElementById(\"song_title\");\n\tconst authorEl = document.getElementById(\"song_author\");\n\tconst coverEl = document.getElementById(\"song_cover\");\n\n\tauthorEl!.textContent = author;\n\ttitleEl!.textContent = title;\n\tcoverEl!.setAttribute(\"src\", albumSrc);\n\n\tcontainer?.classList.add(\"show\");\n}\n\nexport function endSong() {\n\tconst container = document.getElementById(\"song\");\n\n\tcontainer?.classList.remove(\"show\");\n}\n","import { AudioPlay, MusicData } from \"kaplay\";\nimport { playerObj } from \"../game\";\nimport { getPosAtBorder, k, layers } from \"../main\";\nimport { spawnAssasin } from \"../spawn/spawnAssasin\";\nimport { spawnMeteorite } from \"../spawn/spawnAsteroid\";\nimport { spawnHighway } from \"../spawn/spawnHighway\";\nimport { spawnShip1 } from \"../spawn/spawnShip1\";\nimport { tags } from \"../tags\";\nimport { Level } from \"../wave\";\nimport { endSong, loadSongData } from \"../web\";\n\nlet lvlData: any = {};\nlet timer = 0;\nlet spawned = 0;\nlet toSpawn = 0;\nlet song: AudioPlay;\nexport const level1: Level = {\n\tmusic: \"arcadia\",\n\tsongTitle: \"Arcadia\",\n\tsongAuthor: \"Dunderpatrullen\",\n\tsongAlbumCover: \"/covers/arcadia_cover.jpg\",\n\tbpm: 0.44,\n\ttitle: \"\",\n\tintroduceSound: \"\",\n\tlevelLengthSeconds: 190,\n\treset: () => {\n\t\tlvlData = {};\n\t\tsong.stop();\n\t\tendSong();\n\t},\n\tlvlUpd: () => {},\n\twaves: [\n\t\t{\n\t\t\ttimeStamp: 0,\n\t\t\tbegin: () => {\n\t\t\t\tsong = k.play(level1.music, { volume: 0.9 });\n\t\t\t},\n\t\t\tupd: () => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 3500,\n\t\t\tbegin: () => {\n\t\t\t\tloadSongData(\n\t\t\t\t\tlevel1.songTitle,\n\t\t\t\t\tlevel1.songAuthor,\n\t\t\t\t\tlevel1.songAlbumCover\n\t\t\t\t);\n\t\t\t},\n\t\t\tupd: () => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 4500,\n\t\t\tbegin: (ld) => {\n\t\t\t\tvar txt = k.add([\n\t\t\t\t\tk.pos(k.center()),\n\t\t\t\t\tk.anchor(\"center\"),\n\t\t\t\t\tk.animate(),\n\t\t\t\t\tk.text(\"...INIT SPACEJUMP...\", { font: \"\", size: 42 }),\n\t\t\t\t\ttags.gameLoopUi,\n\t\t\t\t]);\n\n\t\t\t\ttxt.animate(\"opacity\", [1, 0], {\n\t\t\t\t\tloops: 5,\n\t\t\t\t\tduration: 0.7,\n\t\t\t\t});\n\n\t\t\t\tlvlData[\"txt\"] = txt;\n\t\t\t},\n\t\t\tupd: () => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 4550,\n\t\t\tduration: 3550,\n\t\t\tbegin: () => {\n\t\t\t\tlvlData[\"lines\"] = [];\n\t\t\t},\n\t\t\tupd: (ld) => {\n\t\t\t\tvar randomPos = k.rand(k.vec2(k.width(), k.height()));\n\n\t\t\t\tvar line = k.add([\n\t\t\t\t\tk.pos(randomPos),\n\t\t\t\t\tk.rect(2, 4 * (ld / 100)),\n\t\t\t\t\tk.color(k.WHITE),\n\t\t\t\t\t\"dust\",\n\t\t\t\t]);\n\n\t\t\t\tlvlData[\"lines\"].push(line);\n\n\t\t\t\tfor (let i = 0; i < lvlData[\"lines\"].length; i++) {\n\t\t\t\t\tlvlData[\"lines\"][i].move(0, -10 * (ld / 50));\n\t\t\t\t}\n\n\t\t\t\tif (ld > 2000) {\n\t\t\t\t\tk.shake(0.01 * (ld / 100));\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 8120,\n\t\t\tbegin: () => {\n\t\t\t\tk.destroyAll(\"dust\");\n\t\t\t\tk.flash(k.WHITE, 1);\n\t\t\t\tk.destroy(lvlData[\"txt\"]);\n\t\t\t\tdelete lvlData[\"lines\"];\n\t\t\t\tconst spawn = 40;\n\n\t\t\t\tfor (let i = 0; i < spawn; i++) {\n\t\t\t\t\tvar randomPos = k.rand(k.vec2(k.width(), k.height()));\n\n\t\t\t\t\tif (playerObj.pos.dist(randomPos) < 200) continue;\n\t\t\t\t\tspawnMeteorite({\n\t\t\t\t\t\tpos: randomPos,\n\t\t\t\t\t\tdir: k.DOWN,\n\t\t\t\t\t\tscoreOnKill: 1,\n\t\t\t\t\t\thp: 3,\n\t\t\t\t\t\tspeed: k.rand(20, 40),\n\t\t\t\t\t\tsplitOnDeath: 2,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tk.add([\n\t\t\t\t\tk.pos(100),\n\t\t\t\t\tk.color(k.rgb(50, 50, 50)),\n\t\t\t\t\tk.sprite(\"bg_moon1\"),\n\t\t\t\t\tk.scale(2),\n\t\t\t\t\tk.layer(layers.bg),\n\t\t\t\t\ttags.levelBg,\n\t\t\t\t]);\n\n\t\t\t\tk.add([\n\t\t\t\t\tk.pos(100, 400),\n\t\t\t\t\tk.color(k.rgb(50, 50, 50)),\n\t\t\t\t\tk.sprite(\"bg_building1\"),\n\t\t\t\t\tk.scale(2),\n\t\t\t\t\tk.layer(layers.bg),\n\t\t\t\t\ttags.levelBg,\n\t\t\t\t]);\n\t\t\t},\n\t\t\tupd: (ld) => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 16000,\n\t\t\tbegin: () => {\n\t\t\t\tvar txt = k.add([\n\t\t\t\t\tk.pos(k.center()),\n\t\t\t\t\tk.anchor(\"center\"),\n\t\t\t\t\tk.animate(),\n\t\t\t\t\tk.text(\"!!THREAT DETECTED!!\", { font: \"\", size: 42 }),\n\t\t\t\t\ttags.gameLoopUi,\n\t\t\t\t]);\n\n\t\t\t\ttxt.animate(\"opacity\", [1, 0], {\n\t\t\t\t\tloops: 10,\n\t\t\t\t\tduration: level1.bpm,\n\t\t\t\t});\n\n\t\t\t\tlvlData[\"txt\"] = txt;\n\t\t\t},\n\t\t\tupd: (ld) => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 21000,\n\t\t\tbegin: () => {\n\t\t\t\tk.destroy(lvlData[\"txt\"]);\n\t\t\t\tconst max = 6;\n\n\t\t\t\tfor (let i = 0; i < max; i++) {\n\t\t\t\t\tconst pos = getPosAtBorder(0.25 * (i / max));\n\n\t\t\t\t\tspawnShip1(pos, k.DOWN, 3, 5, 1, k.rand(40, 60));\n\t\t\t\t}\n\t\t\t},\n\t\t\tupd: (ld) => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 18790,\n\t\t\tbegin: () => {\n\t\t\t\tk.flash(k.WHITE, level1.bpm);\n\t\t\t\tconst max = 12;\n\n\t\t\t\tfor (let i = 0; i < max; i++) {\n\t\t\t\t\tconst pos = getPosAtBorder(1 * (i / max));\n\n\t\t\t\t\tspawnShip1(\n\t\t\t\t\t\tpos,\n\t\t\t\t\t\tk.Vec2.fromAngle(pos.angleBetween(k.center())),\n\t\t\t\t\t\t3,\n\t\t\t\t\t\t5,\n\t\t\t\t\t\t1,\n\t\t\t\t\t\tk.rand(40, 60)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\tupd: (ld) => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 22790,\n\t\t\tbegin: () => {\n\t\t\t\tk.flash(k.WHITE, level1.bpm);\n\t\t\t\tconst max = 12;\n\n\t\t\t\tfor (let i = 0; i < max; i++) {\n\t\t\t\t\tconst pos = getPosAtBorder(1 * (i / max));\n\n\t\t\t\t\tspawnShip1(\n\t\t\t\t\t\tpos,\n\t\t\t\t\t\tk.Vec2.fromAngle(pos.angleBetween(k.center())),\n\t\t\t\t\t\t3,\n\t\t\t\t\t\t5,\n\t\t\t\t\t\t1,\n\t\t\t\t\t\tk.rand(40, 60)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\tupd: (ld) => {},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 36744,\n\t\t\tduration: 1000,\n\t\t\tbegin: () => {\n\t\t\t\tk.shake(10);\n\t\t\t},\n\t\t\tupd: (ld) => {\n\t\t\t\ttimer += k.dt();\n\n\t\t\t\tif (timer >= 0.05) {\n\t\t\t\t\tconst rnd = k.rand(1);\n\t\t\t\t\tspawnAssasin(getPosAtBorder(rnd), 2, 2, 1);\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 43824,\n\t\t\tduration: 1500,\n\t\t\tbegin: () => {\n\t\t\t\ttimer = 0;\n\t\t\t\tspawned = 0;\n\t\t\t\ttoSpawn = 30;\n\t\t\t},\n\t\t\tupd: (ld) => {\n\t\t\t\ttimer += k.dt();\n\n\t\t\t\tif (timer >= 0.03 && spawned < toSpawn) {\n\t\t\t\t\tconst t = 0.25 + 0.25 * (spawned / toSpawn);\n\t\t\t\t\tspawnMeteorite({\n\t\t\t\t\t\tpos: getPosAtBorder(t),\n\t\t\t\t\t\tdir: k.LEFT,\n\t\t\t\t\t\tscoreOnKill: 1,\n\t\t\t\t\t\thp: 3,\n\t\t\t\t\t\tspeed: 40,\n\t\t\t\t\t\tsplitOnDeath: 2,\n\t\t\t\t\t});\n\t\t\t\t\tspawned++;\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 45600,\n\t\t\tduration: 1500,\n\t\t\tbegin: () => {\n\t\t\t\ttimer = 0;\n\t\t\t\tspawned = 0;\n\t\t\t\ttoSpawn = 30;\n\t\t\t},\n\t\t\tupd: (ld) => {\n\t\t\t\ttimer += k.dt();\n\n\t\t\t\tif (timer >= 0.03 && spawned < toSpawn) {\n\t\t\t\t\tconst t = 0.75 + 0.25 * (spawned / toSpawn);\n\t\t\t\t\tspawnMeteorite({\n\t\t\t\t\t\tpos: getPosAtBorder(t),\n\t\t\t\t\t\tdir: k.RIGHT,\n\t\t\t\t\t\tscoreOnKill: 1,\n\t\t\t\t\t\thp: 3,\n\t\t\t\t\t\tspeed: 40,\n\t\t\t\t\t\tsplitOnDeath: 2,\n\t\t\t\t\t});\n\t\t\t\t\tspawned++;\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 47000,\n\t\t\tduration: 5000,\n\t\t\tbegin: () => {\n\t\t\t\ttimer = 0;\n\t\t\t\tspawned = 0;\n\t\t\t\ttoSpawn = 30;\n\t\t\t},\n\t\t\tupd: (ld) => {\n\t\t\t\ttimer += k.dt();\n\n\t\t\t\tif (timer >= 0.03 && spawned < toSpawn) {\n\t\t\t\t\tfor (let i = 0; i < 2; i++) {\n\t\t\t\t\t\tconst t = 0.5 * i + 0.25 * (spawned / toSpawn);\n\t\t\t\t\t\tspawnMeteorite({\n\t\t\t\t\t\t\tpos: getPosAtBorder(t),\n\t\t\t\t\t\t\tdir: i == 0 ? k.DOWN : k.UP,\n\t\t\t\t\t\t\tscoreOnKill: 1,\n\t\t\t\t\t\t\thp: 3,\n\t\t\t\t\t\t\tspeed: 40,\n\t\t\t\t\t\t\tsplitOnDeath: 2,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tspawned++;\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 66000,\n\t\t\tduration: 14000,\n\t\t\tbegin: () => {\n\t\t\t\ttimer = 0;\n\t\t\t},\n\t\t\tupd: (ld) => {\n\t\t\t\ttimer += k.dt();\n\n\t\t\t\tif (timer >= level1.bpm * 2) {\n\t\t\t\t\tconst rnd = k.rand(1);\n\t\t\t\t\tspawnAssasin(getPosAtBorder(rnd), 2, 2, 1);\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttimeStamp: 79300,\n\t\t\tbegin: () => {\n\t\t\t\ttimer = 0;\n\t\t\t\tfor (let i = 0; i < 2; i++) {\n\t\t\t\t\tconst yPos = 200 + 300 * i;\n\t\t\t\t\tspawnHighway(k.vec2(0, yPos), k.vec2(k.width(), yPos), 10);\n\t\t\t\t}\n\t\t\t},\n\t\t\tupd: (ld) => {\n\t\t\t\ttimer += k.dt();\n\n\t\t\t\tif (timer >= level1.bpm) {\n\t\t\t\t\tconst rnd = k.rand(1);\n\t\t\t\t\tspawnAssasin(getPosAtBorder(rnd), 2, 2, 1);\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t],\n};\n","import { Comp, GameObj, PosComp, Vec2 } from \"kaplay\";\nimport { k } from \"../main\";\nimport { pickUnitInDistance } from \"../game\";\n\nexport interface TargetComp extends Comp {\n\tlockedTarget: GameObj<PosComp> | null;\n\tpickTarget: (pos: Vec2, dist: number, tag: string) => boolean;\n\ttargetAngle: () => number;\n\thasTarget: () => boolean;\n}\n\nexport function target(): TargetComp {\n\treturn {\n\t\tlockedTarget: null,\n\t\tid: \"target\",\n\t\trequire: [\"pos\"],\n\n\t\tpickTarget(pos: Vec2, dist: number, tag: string) {\n\t\t\tif (this.lockedTarget) return true;\n\t\t\treturn pickUnitInDistance(pos, dist, tag, (u) => {\n\t\t\t\tthis.lockedTarget = u;\n\n\t\t\t\tthis.lockedTarget.onDestroy(() => {\n\t\t\t\t\tthis.lockedTarget = null;\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\thasTarget() {\n\t\t\treturn this.lockedTarget;\n\t\t},\n\t\ttargetAngle() {\n\t\t\tif (!this.lockedTarget) return this.angle;\n\n\t\t\treturn this.lockedTarget.pos.angle(this.pos);\n\t\t},\n\t};\n}\n","import { GameObj, PosComp, Vec2 } from \"kaplay\";\nimport {\n\tcheckProjectileIntersection,\n\tclearGame,\n\tcreateExplosion,\n\tplayerObj,\n} from \"../game\";\nimport { k } from \"../main\";\nimport { debreeRocketEmitter, sparkEmitter, starsEmitter } from \"../particles\";\nimport {\n\tlerpAngleBetweenPos,\n\tlerpMoveRotateAndScale,\n\tregisterHitAnimation,\n} from \"../shared\";\nimport { tags } from \"../tags\";\nimport { randomExplosion } from \"../util\";\nimport { shootBlaster } from \"../projectiles/blaster\";\nimport { target } from \"../comp/target\";\nimport { shootRocket } from \"../projectiles/rocket\";\nimport { player } from \"../player\";\n\ninterface Props {\n\tpos: Vec2;\n\thp: number;\n\tblasterDmg: number;\n\tcanUseMissiles: boolean;\n\tspeed: number;\n\tfollow: GameObj<PosComp>;\n}\n\nexport function spawnFollower(props: Props) {\n\tconst hb = 12;\n\tconst m = k.add([\n\t\tk.pos(props.pos),\n\t\tk.sprite(\"asteroid1\"),\n\t\tk.rotate(0),\n\t\tk.anchor(\"center\"),\n\t\tk.scale(0.4),\n\t\tk.health(props.hp),\n\t\ttarget(),\n\t\tk.animate(),\n\t\tk.offscreen({ destroy: true }),\n\t\t{\n\t\t\tspeed: props.speed,\n\t\t\thb,\n\t\t\tdmg: props.blasterDmg,\n\t\t\tmissiles: props.canUseMissiles,\n\t\t},\n\t\ttags.friendly,\n\t\ttags.unit,\n\t]);\n\n\tregisterHitAnimation(m);\n\n\tm.onUpdate(() => {\n\t\tconst { dir, lerp } = lerpAngleBetweenPos(\n\t\t\tm.angle,\n\t\t\tm.pos,\n\t\t\tprops.follow.pos,\n\t\t\t0.015,\n\t\t\t-90\n\t\t);\n\n\t\tlerpMoveRotateAndScale(m, lerp, m.speed);\n\n\t\tcheckProjectileIntersection(m.pos, m.hb, tags.enemy, (p) => {\n\t\t\tk.destroy(p);\n\n\t\t\tif (p.tags.includes(tags.blaster)) {\n\t\t\t\tm.hurt(p.dmg);\n\t\t\t}\n\t\t});\n\n\t\tif (m.missiles && m.hasTarget()) {\n\t\t\tif (Math.floor(k.rand(0, 300)) == 1) {\n\t\t\t\tshootRocket(\n\t\t\t\t\tm.pos,\n\t\t\t\t\tk.Vec2.fromAngle(m.angle - 90),\n\t\t\t\t\tm.angle,\n\t\t\t\t\tplayer.rocketImpactDmg * player.rocketDmgMultiplier,\n\t\t\t\t\tplayer.rocketSplashDmg * player.rocketDmgMultiplier,\n\t\t\t\t\tplayer.rocketSplashSize * player.rocketSplashSizeMultiplier,\n\t\t\t\t\tplayer.rocketSplashDmgFallDistanceValue,\n\t\t\t\t\tplayer.rocketSplashDmgFallOverDistance,\n\t\t\t\t\t0.8,\n\t\t\t\t\t[tags.friendly, tags.rocket],\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (Math.floor(k.rand(0, 110)) == 1) {\n\t\t\tif (m.pickTarget(m.pos, 400, tags.enemy)) {\n\t\t\t\tshootBlaster(\n\t\t\t\t\tm.pos,\n\t\t\t\t\tk.Vec2.fromAngle(m.targetAngle()),\n\t\t\t\t\tm.targetAngle() + 90,\n\t\t\t\t\tm.dmg,\n\t\t\t\t\t2,\n\t\t\t\t\t[tags.friendly, tags.blaster]\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t});\n\n\tm.onDeath(() => {\n\t\tstarsEmitter.emitter.position = m.pos;\n\t\tstarsEmitter.emit(20);\n\n\t\tk.play(randomExplosion(), { volume: 0.6 });\n\t\tk.destroy(m);\n\t});\n\n\tm.onHurt(() => {\n\t\tk.play(\"hit1\", { volume: 0.6 });\n\t\tm.animation.seek(0);\n\t});\n}\n","import {\n\tAnchorComp,\n\tAnimateComp,\n\tAreaComp,\n\tGameObj,\n\tHealthComp,\n\tPosComp,\n\tRotateComp,\n\tSpriteComp,\n\tVec2,\n} from \"kaplay\";\nimport { k, GameState, changeGameState, addScore } from \"./main\";\nimport { player } from \"./player\";\nimport { explosionEmitter } from \"./particles\";\nimport {\n\tactiveLevel,\n\tLevel,\n\tloadLevel,\n\tresetCurrentLevel,\n\tupdateLvl,\n} from \"./wave\";\nimport { clearPlayer, setupPlayer } from \"./setupPlayer\";\nimport { level1 } from \"./levels/level1\";\nimport { tags } from \"./tags\";\nimport { clearGameLoopUi, setupGameLoopUi } from \"./gameUi\";\nimport { spawnShip1 } from \"./spawn/spawnShip1\";\nimport { Component } from \"./compose\";\nimport { spawnFollower } from \"./spawn/spawnFollower\";\n\nconst lengthBetweenLevels = 1;\n\nexport let playerObj: GameObj<\n\tPosComp | SpriteComp | RotateComp | AreaComp | AnchorComp | HealthComp\n>;\nlet timeSinceLastLevel = 0;\n\nexport let debrees: GameObj<AnimateComp | PosComp | SpriteComp>[] = [];\nexport const projectiles: GameObj<PosComp | any>[] = [];\n\nexport function startGame() {\n\tplayerObj = setupPlayer();\n\tsetupGameLoopUi(player.maxHealth);\n}\n\nexport function updateGameLoop() {\n\tconst dt = k.dt();\n\ttimeSinceLastLevel += dt;\n\n\tif (timeSinceLastLevel >= lengthBetweenLevels && !activeLevel()) {\n\t\tloadLevel(level1);\n\n\t\tfor (let i = 0; i < player.nrOfFollowers; i++) {\n\t\t\tspawnFollower({\n\t\t\t\tfollow: playerObj,\n\t\t\t\thp: 6,\n\t\t\t\tpos: k.vec2(k.rand(k.width()), 0),\n\t\t\t\tspeed: k.rand(80, 110),\n\t\t\t\tblasterDmg:\n\t\t\t\t\tplayer.followerBlasterDmg * player.followerBlasterDmgMultiplier,\n\t\t\t\tcanUseMissiles: player.followerCanUseMissiles !== undefined,\n\t\t\t});\n\t\t}\n\t}\n\n\tif (activeLevel()) {\n\t\tif (updateLvl()) {\n\t\t\ttimeSinceLastLevel = 0;\n\t\t\tresetCurrentLevel();\n\t\t}\n\t}\n\n\tfor (let i = 0; i < debrees.length; i++) {\n\t\tconst d = debrees[i];\n\n\t\tconst dist = d.pos.dist(playerObj.pos);\n\n\t\tif (\n\t\t\tdist <\n\t\t\tplayer.debreeSeekDistance * player.debreeSeekDistanceMultiplier\n\t\t) {\n\t\t\td.moveTo(\n\t\t\t\tplayerObj.pos,\n\t\t\t\tplayer.debreeSeekSpeed * player.debreeSeekSpeedMultiplier\n\t\t\t);\n\n\t\t\tif (dist < player.debreePickupDistance) {\n\t\t\t\tk.destroy(d);\n\t\t\t\tdebrees.splice(i, 1);\n\t\t\t\tk.play(\"collect1\", { volume: 0.6 });\n\t\t\t\taddScore(player.scorePerPickup);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function clearGame() {\n\tclearPlayer();\n\ttimeSinceLastLevel = 0;\n\tdebrees = [];\n\tresetCurrentLevel();\n\tk.destroyAll(tags.enemy);\n\tk.destroyAll(tags.blaster);\n\tk.destroyAll(tags.rocket);\n\tk.destroyAll(tags.enemy);\n\tk.destroyAll(tags.levelBg);\n\tk.destroyAll(tags.unit);\n\tk.destroyAll(tags.debree);\n\tclearGameLoopUi();\n\tchangeGameState(GameState.LevelUp);\n}\n\nexport function createExplosion(\n\tpos,\n\tradius,\n\tsplashDmg,\n\tsplashDmgFallof,\n\tsplashDmgFallofDist\n) {\n\tconst enemies = k.query({\n\t\tinclude: [tags.enemy, tags.unit],\n\t\tincludeOp: \"and\",\n\t});\n\texplosionEmitter.emitter.position = pos;\n\texplosionEmitter.emit(14);\n\n\tfor (let i = 0; i < enemies.length; i++) {\n\t\tif (enemies[i].pos.dist(pos) < radius) {\n\t\t\tenemies[i].hurt(splashDmg);\n\t\t}\n\t}\n}\n\nexport function checkProjectileIntersection(\n\tpos: Vec2,\n\tdist: number,\n\tprojectilesWithTag: string,\n\tonHit: (p: GameObj<PosComp | RotateComp | any>) => void\n) {\n\tfor (let i = 0; i < projectiles.length; i++) {\n\t\tconst p = projectiles[i];\n\n\t\tif (p.pos.dist(pos) < dist) {\n\t\t\tif (!p.tags.includes(projectilesWithTag)) continue;\n\n\t\t\tonHit(p);\n\t\t}\n\t}\n}\nexport function checkProjectileComponentIntersection(\n\tpos: Vec2,\n\tdist: number,\n\tprojectilesWithTag: string,\n\tcomponents: Component[],\n\tonHit: (p: GameObj<PosComp | RotateComp | any>, index: number) => void\n) {\n\tfor (let i = 0; i < projectiles.length; i++) {\n\t\tconst p = projectiles[i];\n\n\t\tif (p.pos.dist(pos) < dist) {\n\t\t\tif (!p.tags.includes(projectilesWithTag)) continue;\n\n\t\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\t\tif (components[i].obj.hidden) continue;\n\n\t\t\t\tif (\n\t\t\t\t\tp.pos.dist(pos.sub(components[i].localPos)) < components[i].hitbox\n\t\t\t\t) {\n\t\t\t\t\tonHit(p, i);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function pickUnitInDistance(\n\tpos: Vec2,\n\tdist: number,\n\ttag: string,\n\tonFound: (u: GameObj) => void\n) {\n\tconst units = k.query({ include: [tag, tags.unit], includeOp: \"and\" });\n\tfor (let i = 0; i < units.length; i++) {\n\t\tconst u = units[i];\n\n\t\tif (u.pos.dist(pos) < dist) {\n\t\t\tonFound(u);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n","import {\n\tAreaComp,\n\tGameObj,\n\tOpacityComp,\n\tPosComp,\n\tSpriteComp,\n\tTextComp,\n\tVec2,\n} from \"kaplay\";\nimport { addScore, changeGameState, GameState, k, score } from \"./main\";\nimport { loadPlayer } from \"./player\";\nimport { addLvl, getNextLvl, loadout, Tool, ToolKey, upgrades } from \"./upg\";\nimport { starsEmitter } from \"./particles\";\n\nconst gridTag = \"ui_grid\";\n\ninterface ToolGroup {\n\tgroup?: GameObj<PosComp>;\n\ttitle?: GameObj<TextComp>;\n\theader?: GameObj<TextComp>;\n\tdesc?: GameObj<TextComp>;\n\ticon?: GameObj<SpriteComp>;\n\tpurchaseBtn?: GameObj<AreaComp | OpacityComp>;\n\tpurchaseBtnText?: GameObj<TextComp>;\n}\n\nlet selectedTool: { key: ToolKey; index: number };\nlet toolGroupObj: ToolGroup = {\n\tgroup: undefined,\n\ttitle: undefined,\n\theader: undefined,\n\tdesc: undefined,\n\ticon: undefined,\n};\nlet highlightKeyObj: Record<string, GameObj> = {};\nlet scoreTxt: GameObj<TextComp>;\nlet selectedPos: Vec2;\n\nexport function enterLevelUp() {\n\tconst center = k.center();\n\n\tconst g1 = uiGroup(k.vec2(center.x, 40), \"ui\");\n\n\tg1.add([k.text(\"UPGRADE\", { size: 22, font: \"unscii\" }), k.anchor(\"center\")]);\n\n\tscoreTxt = addTextWithBorder(g1, 12, getScoreStr(score), k.vec2(0, 50));\n\n\treloadUpgradeGrid(center);\n\n\ttoolGroupObj.group = uiGroup(\n\t\tk.vec2(center.x + center.x / 2 - 100, center.y - center.y / 2 - 40),\n\t\t\"ui\"\n\t);\n\ttoolGroupObj.group.hidden = true;\n\tbuildToolUi();\n\n\taddBtn(\"START GAME\", k.vec2(center.x, center.y * 2 - 60), () => {\n\t\tclearLevelUp();\n\t\tchangeGameState(GameState.Playing);\n\t});\n}\n\nexport function updateLevelUpLoop() {}\n\nexport function clearLevelUp() {\n\tk.destroyAll(\"ui\");\n\tk.destroyAll(gridTag);\n}\n\nfunction reloadUpgradeGrid(pos: Vec2) {\n\tk.destroyAll(gridTag);\n\tconst gridGroup = uiGroup(k.vec2(60, pos.y), gridTag);\n\n\tvar upgs = upgrades;\n\n\tvar keys = Object.entries(upgs)\n\t\t.filter(([_, v]) => {\n\t\t\tif (!v.requiredTool) return true;\n\n\t\t\treturn loadout[v.requiredTool] !== undefined;\n\t\t})\n\t\t.map(([k, _]) => k) as ToolKey[];\n\n\tconst maxColumns = 4;\n\tlet row = -1;\n\tconst size = 42;\n\tconst spacing = 8;\n\tconst upgSize = 16;\n\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tconst tool = upgrades[keys[i]] as Tool;\n\t\tconst upgIndex = getNextLvl(keys[i]);\n\n\t\tif (i % maxColumns == 0) {\n\t\t\trow++;\n\t\t}\n\n\t\tconst col = i - maxColumns * row;\n\n\t\tconst btn = gridGroup.add([\n\t\t\tk.pos(k.vec2((size + spacing) * col, (size + spacing) * row)),\n\t\t\tk.rect(size, size),\n\t\t\tk.area(),\n\t\t\tk.color(0, 0, 0),\n\t\t\tk.anchor(\"center\"),\n\t\t\tk.outline(1, new k.Color(255, 255, 255)),\n\t\t\tgridTag,\n\t\t]);\n\n\t\tconst highlight = btn.add([\n\t\t\tk.rect(size + 4, size + 4),\n\t\t\tk.pos(-2, -2),\n\t\t\tk.color(0, 0, 0),\n\t\t\tk.opacity(0.2),\n\t\t\tk.anchor(\"center\"),\n\t\t\tk.outline(2, new k.Color(255, 255, 255)),\n\t\t\tgridTag,\n\t\t]);\n\t\thighlight.hidden = true;\n\t\thighlightKeyObj[keys[i]] = highlight;\n\n\t\tif (upgIndex > 0) {\n\t\t\tconst c = btn.add([\n\t\t\t\tk.pos(upgSize, -size / 2),\n\t\t\t\tk.rect(upgSize, upgSize),\n\t\t\t\tk.anchor(\"center\"),\n\t\t\t\tk.color(255, 255, 255),\n\t\t\t]);\n\t\t\tc.add([\n\t\t\t\tk.text(`${upgIndex}`, { size: 14, font: \"unscii\" }),\n\t\t\t\tk.pos(0, 2),\n\t\t\t\tk.anchor(\"center\"),\n\t\t\t\tk.color(0, 0, 0),\n\t\t\t]);\n\t\t}\n\n\t\tconst clampIndex = k.clamp(upgIndex, 0, tool.upgrades.length - 1);\n\n\t\tbtn.add([\n\t\t\tk.sprite(tool.upgrades[clampIndex].sprite, { height: 24, width: 24 }),\n\t\t\tk.anchor(\"center\"),\n\t\t]);\n\n\t\tbtn.onClick(() => onClick(keys[i], upgIndex, btn.worldPos()!));\n\t}\n}\n\nfunction onClick(key: ToolKey, upgIndex: number, pos: Vec2) {\n\tif (selectedTool) {\n\t\thighlightKeyObj[selectedTool.key].hidden = true;\n\t}\n\thighlightKeyObj[key].hidden = false;\n\tloadTool(key, upgIndex);\n\tk.play(\"click1\", { volume: 1 });\n\tselectedPos = pos;\n}\n\nfunction buildToolUi() {\n\tconst containerWidth = 200;\n\tconst containerHeight = 300;\n\ttoolGroupObj.header = toolGroupObj.group!.add([\n\t\tk.text(\"LEVEL 1\", { size: 10, font: \"unscii\" }),\n\t\tk.anchor(\"top\"),\n\t\tk.pos(containerWidth / 2, 0),\n\t]);\n\ttoolGroupObj.title = toolGroupObj.group!.add([\n\t\tk.text(\"BLASTER\", { size: 14, font: \"unscii\" }),\n\t\tk.anchor(\"top\"),\n\t\tk.pos(containerWidth / 2, 22),\n\t]);\n\tconst container = toolGroupObj.group!.add([\n\t\tk.pos(0, 80),\n\t\tk.rect(containerWidth, containerHeight),\n\t\tk.color(0, 0, 0),\n\t\tk.outline(2, new k.Color(255, 255, 255)),\n\t]);\n\tconst c2 = container.add([\n\t\tk.rect(containerWidth / 2, 60),\n\t\tk.color(0, 0, 0),\n\t\tk.anchor(\"center\"),\n\t\tk.pos(containerWidth / 2, 10),\n\n\t\tk.outline(2, new k.Color(255, 255, 255)),\n\t]);\n\n\ttoolGroupObj.icon = c2.add([\n\t\tk.sprite(\"ship\", { height: 32, width: 32 }),\n\t\tk.anchor(\"center\"),\n\t]);\n\n\ttoolGroupObj.desc = container.add([\n\t\tk.pos(0, 80),\n\t\tk.text(\"EQUIPE YOUR SHIP WITH A LASER BLASTER, LEFT MOUSE TO FIRE\", {\n\t\t\tsize: 12,\n\t\t\tfont: \"unscii\",\n\t\t\twidth: containerWidth,\n\t\t\talign: \"center\",\n\t\t\tlineSpacing: 12,\n\t\t}),\n\t]);\n\n\ttoolGroupObj.purchaseBtn = toolGroupObj.group!.add([\n\t\tk.rect(containerWidth + 40, 50),\n\t\tk.area(),\n\t\tk.opacity(1),\n\t\tk.anchor(\"center\"),\n\t\tk.pos(containerWidth / 2, containerHeight + 40),\n\t]);\n\n\ttoolGroupObj.purchaseBtnText = toolGroupObj.purchaseBtn!.add([\n\t\tk.text(\"PURCHASE 12P\", { size: 16, font: \"unscii\" }),\n\t\tk.color(0, 0, 0),\n\t\tk.anchor(\"center\"),\n\t]);\n\n\ttoolGroupObj.purchaseBtn!.onClick(() => {\n\t\tif (toolGroupObj.group!.hidden || toolGroupObj.purchaseBtn?.hidden) return;\n\t\tconst toPurchase = upgrades[selectedTool.key].upgrades[selectedTool.index];\n\t\tif (score < toPurchase.price) {\n\t\t\tk.play(\"error\", { volume: 0.4 });\n\t\t\treturn;\n\t\t}\n\n\t\taddScore(-toPurchase.price);\n\t\taddLvl(selectedTool.key);\n\t\treloadUpgradeGrid(k.center());\n\t\tloadTool(selectedTool.key, selectedTool.index + 1);\n\t\tstarsEmitter.emitter.position = selectedPos;\n\t\tstarsEmitter.emit(20);\n\t\tloadPlayer();\n\t\tk.play(\"purchase1\", { volume: 0.8 });\n\t\tscoreTxt.text = getScoreStr(score);\n\t});\n}\n\nfunction loadTool(key: ToolKey, upgIndex: number) {\n\tconst tool = upgrades[key];\n\tconst clampedUpgIndex = k.clamp(upgIndex, 0, tool.upgrades.length - 1);\n\ttoolGroupObj.group!.hidden = false;\n\tconst upg = tool.upgrades[clampedUpgIndex];\n\n\ttoolGroupObj.title!.text = tool.toolName.toUpperCase();\n\ttoolGroupObj.desc!.text = upg.desc.toUpperCase();\n\ttoolGroupObj.header!.text = upg.name.toUpperCase();\n\ttoolGroupObj.icon!.sprite = upg.sprite;\n\tselectedTool = {\n\t\tkey: key,\n\t\tindex: clampedUpgIndex,\n\t};\n\n\tif (upgIndex != clampedUpgIndex) {\n\t\ttoolGroupObj.purchaseBtn!.hidden = true;\n\t\treturn;\n\t}\n\n\ttoolGroupObj.purchaseBtnText!.text = `PURCHASE ${upg.price}P`;\n\n\ttoolGroupObj.purchaseBtn!.hidden = false;\n\tif (score < upg.price) {\n\t\ttoolGroupObj.purchaseBtn!.opacity = 0.3;\n\t\treturn;\n\t}\n\ttoolGroupObj.purchaseBtn!.opacity = 1;\n}\n\nfunction addBtn(txt: string, pos: Vec2, onClick: () => void) {\n\tconst btn = k.add([\n\t\tk.pos(pos),\n\t\tk.rect(300, 50),\n\t\tk.area(),\n\t\tk.color(0, 0, 0),\n\t\tk.anchor(\"center\"),\n\t\t\"ui\",\n\t]);\n\n\tbtn.add([k.text(txt, { size: 16, font: \"unscii\" }), k.anchor(\"center\")]);\n\n\tbtn.onClick(onClick);\n\n\treturn btn;\n}\n\nfunction addTextWithBorder(group: GameObj, size: number, txt: string, p: Vec2) {\n\tconst b = group.add([\n\t\tk.rect(80, 40),\n\t\tk.pos(p),\n\t\tk.anchor(\"center\"),\n\t\tk.outline(2, new k.Color(255, 255, 255)),\n\t\tk.color(0, 0, 0),\n\t]);\n\n\tconst text = b.add([\n\t\tk.text(txt, { size: size, font: \"unscii\" }),\n\t\tk.anchor(\"center\"),\n\t]);\n\treturn text;\n}\n\nfunction uiGroup(pos: Vec2, tag: string) {\n\treturn k.add([k.pos(pos), tag]);\n}\n\nfunction getScoreStr(s: number) {\n\treturn `${s}P`;\n}\n","import kaplay, { Vec2 } from \"kaplay\";\nimport { init, loadGame, saveGame } from \"./util\";\nimport { startGame, updateGameLoop } from \"./game\";\nimport { enterLevelUp, updateLevelUpLoop } from \"./levelUp\";\nimport { setLoadout } from \"./upg\";\nimport { loadPlayer } from \"./player\";\nimport { initParticles } from \"./particles\";\n\nexport const layers = {\n\tbg: \"bg\",\n\tgame: \"game\",\n\tui: \"ui\",\n};\n\nexport const GameState = {\n\tPlaying: 1,\n\tLevelUp: 2,\n};\n\nconst borderOffset = -22;\nexport let score = 40;\nexport const BULLET_SPEED = 320;\nexport const ROCKET_SPEED = 280;\nexport let timeSeconds = 0;\nexport const outsideBorderPos: Vec2[] = [];\n\nlet gameState = GameState.Playing;\n\nexport const k = kaplay({\n\tbackground: \"#000000\",\n\tglobal: false,\n\tscale: 1.3,\n\twidth: 600,\n\theight: 600,\n});\n\ninit(k).then(() => {\n\tinitParticles();\n\tloadGameSlot();\n\tk.setLayers([layers.bg, layers.game, layers.ui], layers.game);\n\n\taddBorderOffsets();\n\n\tchangeGameState(GameState.LevelUp);\n\n\tk.onUpdate(() => {\n\t\tif (gameState == GameState.Playing) {\n\t\t\ttimeSeconds += k.dt();\n\t\t\tupdateGameLoop();\n\t\t} else if (gameState == GameState.LevelUp) {\n\t\t\tupdateLevelUpLoop();\n\t\t}\n\t});\n});\n\nexport function changeGameState(state: number) {\n\tgameState = state;\n\n\tif (gameState == GameState.Playing) {\n\t\tstartGame();\n\t} else if (gameState == GameState.LevelUp) {\n\t\tsaveGame(\"slot1\");\n\t\tenterLevelUp();\n\t}\n}\n\nexport function addScore(am: number) {\n\tscore += am;\n}\n\nfunction loadGameSlot() {\n\tvar slot = loadGame(\"slot1\");\n\tif (!slot) return;\n\n\tsetLoadout(slot.loadout);\n\tscore = slot.score;\n\ttimeSeconds = slot.time;\n\tloadPlayer();\n}\n\nfunction addBorderOffsets() {\n\tconst center = k.center();\n\toutsideBorderPos.push(k.vec2(-borderOffset, -borderOffset));\n\toutsideBorderPos.push(k.vec2(center.x * 2 + borderOffset, -borderOffset));\n\toutsideBorderPos.push(\n\t\tk.vec2(center.x * 2 + borderOffset, center.y * 2 + borderOffset)\n\t);\n\toutsideBorderPos.push(k.vec2(-borderOffset, center.y * 2 + borderOffset));\n}\n\nexport function getPosAtBorder(t: number) {\n\tconst index = Math.floor(outsideBorderPos.length * t);\n\tconst subtractT = (1 / outsideBorderPos.length) * index;\n\tconst deltaT = (t - subtractT) * outsideBorderPos.length;\n\tconst newPos = (\n\t\tindex + 1 >= outsideBorderPos.length\n\t\t\t? outsideBorderPos[0]\n\t\t\t: outsideBorderPos[index + 1]\n\t).sub(outsideBorderPos[index]);\n\n\tconst clampedIndex = k.clamp(index, 0, outsideBorderPos.length - 1);\n\n\treturn outsideBorderPos[clampedIndex].add(newPos.scale(deltaT));\n}\n"],"names":["blaster","blasterMultiple","blasterSpeed","blasterDmg","follower","followerBlasterDmg","followerMissiles","rocket","increaseRockets","rocketShards","rocketShardsAmount","debreeDist","debreeSpeed","sprint","sprintSpeed","movespeed","debreeValue","maxHealth","upgrades","loadout","getToolUpgradeLvlValue","key","addLvl","getNextLvl","saveGame","setLoadout","set","init","k","explArr","randomExplosion","r","adjustedTarget","from","to","shortestAngleDelta","delta","slot","save","score","timeSeconds","loadGame","p","player","loadPlayer","hasLvlValue","value","lvl","trailEmitter","starsEmitter","starsEmitterDir","explosionEmitter","debreeRocketEmitter","initParticles","currentLvl","nextWaveIndex","currentWaveIndex","timeDuringLevel","loadLevel","updateLvl","waveEndedTimestamp","activeLevel","resetCurrentLevel","resetLvlData","tags","healthBars","specialBar","height","specialHeight","setupGameLoopUi","health","i","offset","c","updatePlayerHealthBar","newHealth","clamp","updateSpecialBar","current","max","clearGameLoopUi","shootBlaster","pos","dir","rot","dmg","speedMltp","BULLET_SPEED","index","projectiles","p2","registerHitAnimation","m","lerpAngleBetweenPos","angle","pos1","pos2","hardness","addAngle","a","desiredRot","correctedDesiredRot","lerpMoveRotateAndScale","lerp","speed","lerpAngle","x","y","acquireTargetAfter","trailOffset","maxSpeed","shootRocket","impactDmg","splashDmg","splashSize","splashDmgFallof","splashDmgFallofDist","tagsToAttach","canSeek","ROCKET_SPEED","currentDir","emitterPos","pickUnitInDistance","u","_a","shards","blasters","bulletIndex","specialTimer","rocketSpecialCooldown","setupPlayer","playerObj","clearGame","checkProjectileIntersection","createExplosion","dist","playerCurrentDir","gunPipe","clearPlayer","spawnDebree","am","d","debrees","spawnAssasin","hp","scale","hb","spawnMeteorite","props","initScale","spawnGenericVehicle","addTo","sprite","spawnHighway","startPos","endPos","intensity","smallOffset","randomVehicle","sprites","compose","composed","body","part","unitComponents","detach","force","v","jitter","strength","toJitter","wingOffset","spawnShip1","wing1","wing2","checkProjectileComponentIntersection","loadSongData","title","author","albumSrc","container","titleEl","authorEl","coverEl","endSong","lvlData","timer","spawned","toSpawn","song","level1","ld","txt","randomPos","line","spawn","layers","getPosAtBorder","rnd","t","yPos","target","tag","spawnFollower","lengthBetweenLevels","timeSinceLastLevel","startGame","updateGameLoop","dt","addScore","changeGameState","GameState","radius","enemies","projectilesWithTag","onHit","components","onFound","units","gridTag","selectedTool","toolGroupObj","highlightKeyObj","scoreTxt","selectedPos","enterLevelUp","center","g1","uiGroup","addTextWithBorder","getScoreStr","reloadUpgradeGrid","buildToolUi","addBtn","clearLevelUp","gridGroup","upgs","keys","_","maxColumns","row","size","spacing","upgSize","tool","upgIndex","col","btn","highlight","clampIndex","onClick","loadTool","c2","toPurchase","clampedUpgIndex","upg","group","s","borderOffset","outsideBorderPos","gameState","kaplay","loadGameSlot","addBorderOffsets","state","subtractT","deltaT","newPos","clampedIndex"],"mappings":"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"}