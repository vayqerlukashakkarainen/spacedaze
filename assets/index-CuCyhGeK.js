import{U as Xe}from"./kaplay-D9oRpw-2.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function a(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=a(i);fetch(i.href,o)}})();const Ze={toolName:"Blaster",upgrades:[{name:"Level 1",desc:"Add a second blaster to your ship",price:12,sprite:"blaster1",value:1},{name:"Level 2",desc:"Add a third blaster to your ship",price:12,sprite:"blaster1",value:2}]},et={toolName:"Parallel processor",requiredTool:"blaster",upgrades:[{name:"Level 1",desc:"Fire all blasters at the same time",price:12,sprite:"parallel_blasters_upg1",value:1}]},tt={toolName:"Blaster speed",requiredTool:"blaster",upgrades:[{name:"Level 1",desc:"Increase velocity of blaster projectiles",price:12,sprite:"blaster_upg_speed1",value:1.65}]},rt={toolName:"Blaster dmg",requiredTool:"blaster",upgrades:[{name:"Level 1",desc:"Increase damage of the ships primary blasters",price:12,sprite:"blaster_upg_dmg1",value:2}]},at={toolName:"Followers",upgrades:[{name:"Level 1",desc:"Increase your followers blaster damage",sprite:"follower_blaster_dmg_upg1",price:22,value:1},{name:"Level 2",desc:"Too... Many... Damage... Numbers...",sprite:"follower_blaster_dmg_upg1",price:22,value:2}]},st={toolName:"Followers",upgrades:[{name:"Level 1",desc:"Your followers will become quite dangerous (with missiles)",sprite:"follower_missiles_upg1",price:22,value:1}]},ot={toolName:"Missile barrage",upgrades:[{name:"Level 1",desc:"Install missile pods to the ship, right mouse to fire",sprite:"rocket_upg1",price:22,value:1}]},it={toolName:"Increase missiles",requiredTool:"rockets",upgrades:[{name:"Level 1",desc:"Increase missiles to 6",sprite:"more_missiles_upg1",price:22,value:6},{name:"Level 2",desc:"Increase missiles to 8",sprite:"more_missiles_upg1",price:22,value:8},{name:"Level 3",desc:"Increase missiles to 10",sprite:"more_missiles_upg1",price:22,value:10},{name:"Level 4",desc:"Increase missiles to 16, missiles will be taped outside the pod",sprite:"more_missiles_upg1",price:22,value:16}]},nt={toolName:"Missile shards",requiredTool:"rockets",upgrades:[{name:"Level 1",desc:"Missiles are loaded with space debree, shooting shards when exploded",sprite:"missile_shards_upg1",price:22,value:5},{name:"Level 2",desc:"Squeeze some more debree in those missiles!!",sprite:"missile_shards_upg1",price:22,value:7},{name:"Level 3",desc:"Squeeze some more debree in those missiles!!",sprite:"missile_shards_upg1",price:22,value:9}]},lt={toolName:"Debree magnets",upgrades:[{name:"Level 1",desc:"Upgrade the ships magnetic magnets and increase debree collect distance",sprite:"debree_dist_upg1",price:32,value:1.2},{name:"Level 2",desc:"Upgrade the ships magnetic magnets and increase debree collect distance",sprite:"debree_dist_upg1",price:32,value:1.4},{name:"Level 3",desc:"Upgrade the ships magnetic magnets and increase debree collect distance",sprite:"debree_dist_upg1",price:32,value:1.6},{name:"Level 4",desc:"Upgrade the ships magnetic magnets and increase debree collect distance",sprite:"debree_dist_upg1",price:32,value:1.8},{name:"Level 5",desc:"Upgrade the ships magnetic magnets and increase debree collect distance",sprite:"debree_dist_upg1",price:32,value:2}]},dt={toolName:"Stronger magnets",upgrades:[{name:"Level 1",desc:"Stronger magnets = faster debree, easy math",sprite:"debree_speed_upg1",price:32,value:1.2},{name:"Level 2",desc:"Stronger magnets = faster debree, easy math",sprite:"debree_speed_upg1",price:32,value:1.4},{name:"Level 3",desc:"Stronger magnets = faster debree, easy math",sprite:"debree_speed_upg1",price:32,value:2}]},pt={toolName:"Thrusters overclock",upgrades:[{name:"Level 1",desc:"Hold SHIFT to overclock thrusters, increasing speed",sprite:"overclock_thrusters_upg1",price:32,value:1.2},{name:"Level 2",desc:"Increase speed when overclocking thrusters",sprite:"overclock_thrusters_upg1",price:32,value:1.4}]},ct={toolName:"Thrusters cooling",requiredTool:"sprint",upgrades:[{name:"Level 1",desc:"Pouring unknown liquid on the thrusters seems to make them go faster during overclock??",sprite:"faster_speed_upg1",price:32,value:1.3},{name:"Level 2",desc:"Pour more liquid, the ship probably need some pumps soon...",sprite:"faster_speed_upg1",price:32,value:1.4}]},ut={toolName:"Improved thrusters",upgrades:[{name:"Level 1",desc:"Bigger thrusters, more speed",sprite:"faster_speed_upg1",price:32,value:1.05},{name:"Level 2",desc:"Bigger thrusters, more speed",sprite:"faster_speed_upg1",price:32,value:1.15}]},gt={toolName:"Shiny debree",requiredTool:"debreeDist",upgrades:[{name:"Level 1",desc:"Debree becomes more valueable, who could have thought",sprite:"debree_value_upg1",price:32,value:2},{name:"Level 2",desc:"Debree becomes almost as valuable as gold",sprite:"debree_value_upg1",price:32,value:3}]},mt={toolName:"Stronger hull",upgrades:[{name:"Level 1",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:3},{name:"Level 2",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:4},{name:"Level 3",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:5},{name:"Level 4",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:6},{name:"Level 5",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:7},{name:"Level 6",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:8},{name:"Level 7",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:9},{name:"Level 8",desc:"Upgrade hull and increase health by one",sprite:"hull_upg1",price:32,value:10}]},te={blaster:Ze,blasterParallel:et,blasterDmg:rt,blasterSpeed:tt,rockets:ot,nrOfRockets:it,rocketShards:nt,debreeDist:lt,debreeSpeed:dt,debreeValue:gt,sprint:pt,sprintSpeed:ct,movespeed:ut,maxHealth:mt,followerBlasterDmg:at,followerMissiles:st};let V={blaster:void 0,blasterDmg:void 0,blasterSpeed:void 0,rockets:void 0,debreeDist:void 0,debreeSpeed:void 0,nrOfRockets:void 0,sprint:void 0,movespeed:void 0,debreeValue:void 0,maxHealth:void 0,followerBlasterDmg:void 0,followerMissiles:void 0,rocketShards:void 0,sprintSpeed:void 0,blasterParallel:void 0};function y(t){if(V[t]!==void 0)return te[t].upgrades[V[t]].value}function ht(t){V[t]=Ie(t),He("slot1")}function Ie(t){return V[t]===void 0?0:V[t]+1}function ft(t){V=t}async function vt(t){await t.loadRoot("./"),await t.loadSprite("ship","sprites/ship.png"),await t.loadSprite("crate1","sprites/crate1.png"),await t.loadSprite("bullet1","sprites/bullet1.png"),await t.loadSprite("rocket1","sprites/rocket1.png"),await t.loadSprite("follower","sprites/follower.png"),await t.loadSprite("asteroid1","sprites/asteroid1.png"),await t.loadSprite("enemy_ship1","sprites/enemy_ship1.png"),await t.loadSprite("bike1","sprites/bike1.png"),await t.loadSprite("particle1","sprites/particle1.png"),await t.loadSprite("particle2","sprites/particle2.png"),await t.loadSprite("particle3","sprites/particle3.png"),await t.loadSprite("particle4","sprites/particle4.png"),await t.loadSprite("spark1","sprites/spark1.png"),await t.loadSprite("debree_part1","sprites/debree_part1.png"),await t.loadSprite("blaster1","sprites/upgrades/laser_cannon1.png"),await t.loadSprite("rocket_upg1","sprites/upgrades/rocket_upg1.png"),await t.loadSprite("blaster_upg_speed1","sprites/upgrades/blaster_upg_speed1.png"),await t.loadSprite("blaster_upg_dmg1","sprites/upgrades/blaster_upg_dmg1.png"),await t.loadSprite("debree_dist_upg1","sprites/upgrades/debree_dist_upg1.png"),await t.loadSprite("debree_speed_upg1","sprites/upgrades/debree_speed_upg1.png"),await t.loadSprite("debree_value_upg1","sprites/upgrades/debree_value_upg1.png"),await t.loadSprite("faster_speed_upg1","sprites/upgrades/faster_speed_upg1.png"),await t.loadSprite("hull_upg1","sprites/upgrades/hull_upg1.png"),await t.loadSprite("missile_shards_upg1","sprites/upgrades/missiles_shards_upg1.png"),await t.loadSprite("more_missiles_upg1","sprites/upgrades/more_missiles_upg1.png"),await t.loadSprite("overclock_thrusters_upg1","sprites/upgrades/overclock_thrusters_upg1.png"),await t.loadSprite("parallel_blasters_upg1","sprites/upgrades/parallel_blasters_upg1.png"),await t.loadSprite("follower_upg1","sprites/upgrades/follower_upg1.png"),await t.loadSprite("follower_missiles_upg1","sprites/upgrades/follower_missiles_upg1.png"),await t.loadSprite("follower_blaster_dmg_upg1","sprites/upgrades/follower_blaster_dmg_upg1.png"),await t.loadSprite("bg_moon1","sprites/bg/moon1.png"),await t.loadSprite("bg_building1","sprites/bg/building1.png"),await t.loadBitmapFont("unscii","/fonts/unscii_8x8.png",8,8),await t.loadSound("shoot1","sounds/shoot1.wav"),await t.loadSound("fire_rocket1","sounds/rocket_fire1.wav"),await t.loadSound("explosion1","sounds/explosion1.wav"),await t.loadSound("explosion2","sounds/explosion2.wav"),await t.loadSound("explosion3","sounds/explosion3.wav"),await t.loadSound("explosion4","sounds/explosion4.wav"),await t.loadSound("hit1","sounds/hit1.wav"),await t.loadSound("hit2","sounds/hit2.wav"),await t.loadSound("player_hit1","sounds/player_hit1.wav"),await t.loadSound("collect1","sounds/collect1.wav"),await t.loadSound("click1","sounds/click.wav"),await t.loadSound("purchase","sounds/purchase.wav"),await t.loadSound("error","sounds/error.wav"),await t.loadSound("purchase1","sounds/purchase1.wav"),await t.loadSound("powerup1","sounds/powerup1.wav"),await t.loadSound("crit1","sounds/crit1.wav"),await t.loadMusic("arcadia","songs/arcadia.mp3"),await t.loadSprite("enemy_ship1_left_wing","sprites/ships/enemy1/enemy_ship1_left_wing.png"),await t.loadSprite("enemy_ship1_right_wing","sprites/ships/enemy1/enemy_ship1_right_wing.png"),await t.loadSprite("enemy_ship1_body","sprites/ships/enemy1/enemy_ship1_body.png")}const Me=["explosion1","explosion2","explosion3"];function q(){const t=Math.floor(Math.random()*Me.length);return Me[t]}function bt(t,r){return t+yt(t,r)}function yt(t,r){let a=(r-t)%360;return a>180&&(a-=360),a<-180&&(a+=360),a}function He(t){const r={loadout:V,score:N,time:Pe};localStorage.setItem(t,JSON.stringify(r))}function St(t){var r=localStorage.getItem(t);return r?JSON.parse(r):null}const O={extraHealth:0,extraRockets:0,extraSpaceDebreeInMissiles:0};function wt(){O.extraHealth=0,O.extraRockets=0,O.extraSpaceDebreeInMissiles=0}const n={maxHealth:2,scorePerPickup:1,blasterDmg:2,blasterDmgMultiplier:1,blasterLvl:void 0,blasterParallel:void 0,rocketsLvl:void 0,nrOfRockets:3,rocketShards:0,blasterSpeedMultiplier:1,debreePickupDistance:10,debreeSeekDistance:50,debreeSeekSpeed:80,debreeSeekDistanceMultiplier:1,debreeSeekSpeedMultiplier:1,debreeValueMultiplier:1,rocketImpactDmg:10,rocketSplashDmg:5,rocketDmgMultiplier:1,rocketSplashSize:30,rocketSplashSizeMultiplier:1,rocketSplashDmgFallOverDistance:.7,rocketSplashDmgFallDistanceValue:.6,speed:100,canSprint:void 0,sprintSpeedMultiplier:1,speedMultiplier:1,speedPwrUpMultiplier:1,followerBlasterDmg:1,followerBlasterDmgMultiplier:1,followerCanUseMissiles:void 0,critChance:30,critMultiplier:1.5};function Ve(){n.blasterLvl=y("blaster"),n.blasterParallel=y("blasterParallel"),n.blasterDmgMultiplier=y("blasterDmg")??1,n.blasterSpeedMultiplier=y("blasterSpeed")??1,n.rocketsLvl=y("rockets"),n.nrOfRockets=y("nrOfRockets")??3,n.rocketShards=y("rocketShards")??0,n.debreeSeekDistanceMultiplier=y("debreeDist")??1,n.debreeSeekSpeedMultiplier=y("debreeSpeed")??1,n.debreeValueMultiplier=y("debreeValue")??1,n.canSprint=y("sprint"),n.sprintSpeedMultiplier=y("sprintSpeed")??1,n.speedMultiplier=y("movespeed")??1,n.maxHealth=y("maxHealth")??2,n.followerBlasterDmg=y("followerBlasterDmg")??1,n.followerCanUseMissiles=y("followerMissiles")}function he(t,r){return t===void 0?!1:t>=r}let U,_,ie,ye,ne;function _t(){U=e.add([e.pos(),e.particles({max:2e3,speed:[2,30],lifeTime:[.2,.6],colors:[e.WHITE],opacities:[.8,.6],angle:[0,360],damping:[2,2],scales:[.4,.2,.1],texture:e.getSprite("particle3").data.tex,quads:[e.getSprite("particle3").data.frames[0]]},{rate:1,direction:0,spread:90,position:e.vec2(0,0)}),"trail"]),_=e.add([e.pos(),e.particles({max:1e3,speed:[10,40],angle:[0,360],lifeTime:[1,1.5],colors:[e.rgb(255,255,255)],opacities:[1,.5],scales:[1.4,1,.4,.1],damping:[0,.5],angularVelocity:[-90,90],texture:e.getSprite("particle1").data.tex,quads:[e.getSprite("particle1").data.frames[0]]},{rate:0,direction:-90,spread:360,position:e.vec2()})]),ie=e.add([e.pos(),e.particles({max:1e3,speed:[200,300],angle:[0,360],lifeTime:[1,1.5],colors:[e.rgb(255,255,255)],opacities:[1,.5],scales:[1.4,1,.4,.1],damping:[0,.5],angularVelocity:[-90,90],texture:e.getSprite("particle1").data.tex,quads:[e.getSprite("particle1").data.frames[0]]},{rate:0,direction:-90,spread:40,position:e.vec2()})]),e.add([e.pos(),e.particles({max:1e3,speed:[100,150],lifeTime:[1,1.5],angle:[0,360],colors:[e.rgb(255,255,255)],opacities:[1,.5],damping:[0,.5],texture:e.getSprite("particle4").data.tex,quads:[e.getSprite("particle4").data.frames[0]]},{rate:0,direction:-90,spread:40,position:e.vec2()})]),e.add([e.pos(),e.particles({max:1e3,speed:[10,40],lifeTime:[1,1.5],colors:[e.rgb(255,255,255)],opacities:[1,.5],scales:[1,.4,.1],acceleration:[e.vec2(0,1),e.vec2(0,2)],angularVelocity:[-90,90],texture:e.getSprite("particle1").data.tex,quads:[e.getSprite("particle1").data.frames[0]]},{rate:0,direction:-90,spread:0,position:e.vec2()})]),e.add([e.pos(),e.particles({max:1e3,speed:[5,40],angle:[0,360],lifeTime:[1,2],colors:[e.rgb(255,255,255)],opacities:[.7,.4],angularVelocity:[-90,90],scales:[1,.8,0],texture:e.getSprite("debree_part1").data.tex,quads:[e.getSprite("debree_part1").data.frames[0]]},{rate:0,direction:-90,spread:360,position:e.vec2()})]),ne=e.add([e.pos(),e.particles({max:1e3,speed:[60,80],angle:[0,360],lifeTime:[1,2],colors:[e.rgb(255,255,255)],angularVelocity:[-90,90],scales:[1,.8,.2,0],texture:e.getSprite("debree_part1").data.tex,quads:[e.getSprite("debree_part1").data.frames[0]]},{rate:0,direction:-90,spread:55,position:e.vec2()})]),ye=e.add([e.pos(),e.particles({max:1e3,speed:[30,80],angle:[0,360],lifeTime:[.5,1.2],colors:[e.rgb(255,255,255)],opacities:[.8,.5],scales:[.4,2,1.2,.4,.1],damping:[1,2],texture:e.getSprite("particle3").data.tex,quads:[e.getSprite("particle3").data.frames[0]]},{rate:0,direction:-90,spread:360,position:e.vec2()})])}let b=null,R=-1,L=-1,C=0;function xt(t){b=t,R=0,L=-1}function Dt(){if(!b)return!1;if(C+=e.dt()*1e3,b.levelLengthSeconds<C/1e3)return!0;if(R<b.waves.length&&b.waves[R].timeStamp<C&&L!=R&&(L=R,R++,b.waves[L].begin&&b.waves[L].begin(C)),L>0&&L<b.waves.length){const t=(b.waves[L].duration??0)+b.waves[L].timeStamp;if(C<t)return b.waves[L].upd(C-b.waves[L].timeStamp),b.lvlUpd(),!1}return!1}function Te(){return b!=null}function Ce(){b&&(Lt(b),b=null,C=0)}function Lt(t){R=-1,L=-1,t.reset()}const l={friendly:"friendly",enemy:"enemy",props:"props",gameLoopUi:"game_loop_ui",blaster:"blaster",rocket:"rocket",debree:"debree",unit:"unit",part:"part",levelBg:"level_bg"};let Z=[],De=null;const Pt=10,Q=80;function kt(t){for(let r=0;r<t;r++)je(r);e.add([e.pos(22,e.height()-4-Q),e.rect(4,Q),e.color(e.WHITE),e.opacity(.2),l.gameLoopUi]),De=e.add([e.pos(22,e.height()-4-Q),e.rect(4,Q),e.color(e.WHITE),l.gameLoopUi])}function je(t){const r=Pt*t,a=e.add([e.pos(10,e.height()-10-r),e.rect(10,6),e.color(e.WHITE),e.opacity(1),l.gameLoopUi]);Z.push(a)}function Re(t){for(let r=0;r<Z.length;r++){if(r<t){Z[r].opacity=1;continue}Z[r].opacity=.2}}function Mt(t,r){De.height=Q*(t/r)}function Tt(){e.destroyAll(l.gameLoopUi),Z=[],De=null}function Le(t,r){e.add([e.pos(t),e.circle(12*r),e.color(e.WHITE),e.scale(1),e.opacity(1),e.lifespan(.04)])}function K(t,r,a,s,i,o,d){const p=e.add([e.pos(t),e.move(r,cr*i),e.area(),e.rotate(a),e.offscreen({destroy:!0}),e.anchor("center"),e.sprite("bullet1"),{dmg:s},...o,l.gameLoopUi]);p.onDestroy(()=>{const g=A.findIndex(v=>v.id==p.id);A.splice(g,1),Le(p.pos,.2)}),d&&e.play("shoot1",{volume:f}),A.push(p)}function F(t){t.animate("opacity",[0,1,0,1],{duration:.14,loops:1})}function ce(t,r,a,s,i){const o=r.sub(a).unit(),d=Math.atan2(o.y,o.x),p=e.rad2deg(d)+i,g=bt(t,p);return{dir:o,lerp:e.lerp(t,g,s)}}function ue(t,r,a){const s=e.deg2rad(r+90),i=Math.cos(s),o=Math.sin(s);t.move(i*a*-1,o*a*-1),t.angle=r,t.scale=e.vec2(1,Math.abs(o))}function Ut(t){return t.reduce((r,a)=>r+a,0)}const At=.5,Ue=12,Et=400;function We(t,r,a,s,i,o,d,p,g,v,x){const c=e.add([e.pos(t),e.area(),e.rotate(a),e.offscreen({destroy:!0}),e.anchor("center"),e.scale(1),e.sprite("rocket1"),{impactDmg:s,splashDmg:i,splashSize:o,splashDmgFallof:d,splashDmgFallofDist:p,lifetime:0,speedMltp:g,dir:r,targetUnit:null,canSeek:x},...v,l.gameLoopUi]);e.play("fire_rocket1",{volume:f}),c.onUpdate(()=>{c.lifetime+=e.dt();const P=e.clamp(ur*c.speedMltp*(.3+c.lifetime),0,Et),S=e.Vec2.fromAngle(c.angle-90);if(c.targetUnit){const{lerp:I}=ce(c.angle,c.pos,c.targetUnit.pos,.04,-90);ue(c,I,P)}else c.move(S.x*P,S.y*P);const k=e.vec2(c.pos.x-Ue*S.x,c.pos.y-Ue*S.y);U.emitter.position=k,U.emitter.direction=c.angle,U.emit(1),c.canSeek&&c.lifetime>At&&c.targetUnit==null&&ze(c.pos,200,l.enemy,I=>{var me;c.targetUnit=I,(me=c.targetUnit)==null||me.onDestroy(()=>{c.targetUnit=null})})}),c.onDestroy(()=>{const P=A.findIndex(k=>k.id==c.id);A.splice(P,1),e.play(q(),{volume:ae});const S=n.rocketShards+O.extraSpaceDebreeInMissiles;for(let k=0;k<S;k++){const I=360*(k/S);K(c.pos,e.Vec2.fromAngle(I),I+90,1,1,[l.friendly,l.blaster],!1)}}),A.push(c)}let j=0,Se=1,$=0;const fe=6;function Bt(){const t=e.add([e.pos(e.center()),e.sprite("ship"),e.rotate(0),e.scale(),e.health(n.maxHealth),e.area(),e.anchor("center"),e.animate(),l.friendly]);return F(t),he(n.blasterLvl,1)?(t.add([e.anchor("center"),e.pos(10,0)]),j++,t.add([e.anchor("center"),e.pos(-10,0)]),j++):(t.add([e.anchor("center"),e.pos(0,-6)]),j++),he(n.blasterLvl,2)&&(t.add([e.anchor("center"),e.pos(0,-6)]),j++),t.onDeath(()=>{e.destroy(t),_.emitter.position=t.pos,_.emit(20),e.play("explosion1",{volume:f}),rr()}),t.onUpdate(()=>{$<fe&&($+=e.dt(),Mt($,fe)),J(t.pos,12,l.enemy,g=>{e.destroy(g),g.tags.includes(l.blaster)?t.hurt(g.dmg):g.tags.includes(l.rocket)&&(t.hurt(g.impactDmg),Fe(g.pos,g.splashSize,g.splashDmg,g.splashDmgFallof,g.splashDmgFallofDist),e.play(q(),{volume:f}),e.shake(3))});const r=t.pos.dist(e.mousePos())-12,{dir:a,lerp:s}=ce(t.angle,t.pos,e.mousePos(),.05,-90),i=n.speed*n.speedMultiplier*n.speedPwrUpMultiplier,o=e.clamp(r*4,0,i);t.angle=s;const d=e.Vec2.fromAngle(t.angle+90),p=e.vec2(t.pos.x+12*d.x,t.pos.y+12*d.y);o>4&&(U.emitter.position=p,U.emitter.direction=e.Vec2.toAngle(a),U.emit(1)),ue(t,s,o)}),t.onHurt(()=>{e.play("hit2",{volume:f}),t.animation.seek(0),e.shake(20),e.flash(e.RED,.4),Re(t.hp())}),t.onMousePress("left",()=>{if(he(n.blasterParallel,1)){for(let a=0;a<j;a++){const s=t.children[a];K(s.worldPos(),e.Vec2.fromAngle(t.angle-90),t.angle,n.blasterDmg*n.blasterDmgMultiplier,n.blasterSpeedMultiplier,[l.friendly,l.blaster],!0)}return}const r=t.children[Se%j];K(r.worldPos(),e.Vec2.fromAngle(t.angle-90),t.angle,n.blasterDmg*n.blasterDmgMultiplier,n.blasterSpeedMultiplier,[l.friendly,l.blaster],!0),Se++}),t.onMousePress("right",()=>{n.rocketsLvl!==void 0&&($<fe||($=0,e.loop(.1,()=>{We(t.pos,e.Vec2.fromAngle(t.angle-90),t.angle,n.rocketImpactDmg*n.rocketDmgMultiplier,n.rocketSplashDmg*n.rocketDmgMultiplier,n.rocketSplashSize*n.rocketSplashSizeMultiplier,n.rocketSplashDmgFallDistanceValue,n.rocketSplashDmgFallOverDistance,1,[l.friendly,l.rocket],!0)},n.nrOfRockets+O.extraRockets)))}),t.onKeyDown("shift",()=>{n.canSprint!==void 0&&(n.speedPwrUpMultiplier=1.8*n.sprintSpeedMultiplier)}),t.onKeyRelease("shift",()=>{n.speedPwrUpMultiplier=1}),t}function Ot(){Se=0,j=0}function It(){return{lockedTarget:null,id:"target",require:["pos"],pickTarget(t,r,a){return this.lockedTarget?!0:ze(t,r,a,s=>{this.lockedTarget=s,this.lockedTarget.onDestroy(()=>{this.lockedTarget=null})})},hasTarget(){return this.lockedTarget},targetAngle(){return this.lockedTarget?this.lockedTarget.pos.angle(this.pos):this.angle}}}function Ht(t){const a=e.add([e.pos(t.pos),e.sprite("follower"),e.rotate(0),e.anchor("center"),e.scale(.4),e.health(t.hp),It(),e.animate(),e.offscreen({destroy:!0}),{speed:t.speed,hb:12,dmg:t.blasterDmg},l.friendly,l.unit]);F(a),a.onUpdate(()=>{const{lerp:s}=ce(a.angle,a.pos,t.follow.pos,.015,-90);ue(a,s,a.speed),J(a.pos,a.hb,l.enemy,i=>{e.destroy(i),i.tags.includes(l.blaster)&&a.hurt(i.dmg)}),n.followerCanUseMissiles&&a.hasTarget()&&Math.floor(e.rand(0,300))==1&&We(a.pos,e.Vec2.fromAngle(a.angle-90),a.angle,n.rocketImpactDmg*n.rocketDmgMultiplier,n.rocketSplashDmg*n.rocketDmgMultiplier,n.rocketSplashSize*n.rocketSplashSizeMultiplier,n.rocketSplashDmgFallDistanceValue,n.rocketSplashDmgFallOverDistance,.8,[l.friendly,l.rocket],!0),Math.floor(e.rand(0,150))==1&&a.pickTarget(a.pos,400,l.enemy)&&K(a.pos,e.Vec2.fromAngle(a.targetAngle()),a.targetAngle()+90,a.dmg,2,[l.friendly,l.blaster],!0)}),a.onDeath(()=>{_.emitter.position=a.pos,_.emit(20),e.play(q(),{volume:ae}),e.destroy(a)}),a.onHurt(()=>{e.play("hit1",{volume:f}),a.animation.seek(0)})}function Ne(t,r){const a=e.add([e.pos(t),e.sprite(Ct[r]),e.rotate(0),e.anchor("center"),e.offscreen({destroy:!0}),{dir:e.rand(e.vec2(-1,-1),e.vec2(1,1)),speed:e.rand(40,60),lifeSpan:0},l.props,l.unit]);a.add([e.circle(16),e.scale(1),e.anchor("center"),e.opacity(.2)]),a.onUpdate(()=>{a.lifeSpan<a.speed&&(a.move(a.dir.x*(a.speed-a.lifeSpan),a.dir.y*(a.speed-a.lifeSpan)),a.lifeSpan+=e.dt()*45);const s=a.pos.dist(h.pos);s<n.debreeSeekDistance*n.debreeSeekDistanceMultiplier&&(a.moveTo(h.pos,n.debreeSeekSpeed*n.debreeSeekSpeedMultiplier),s<n.debreePickupDistance&&(_.emitter.position=a.pos,_.emit(20),e.play("powerup1",{volume:f}),e.destroy(a),Vt[r]()))})}const Vt={addFollower:()=>{Ht({follow:h,hp:6,pos:e.vec2(e.rand(e.width()),0),speed:e.rand(80,110),blasterDmg:n.followerBlasterDmg*n.followerBlasterDmgMultiplier})},addPlayerMaxHealth:()=>{sr()},addExtraRockets:()=>{O.extraRockets+=1},addSpaceDebree:()=>{O.extraSpaceDebreeInMissiles+=2}},Ct={addFollower:"follower_upg1",addPlayerMaxHealth:"hull_upg1",addExtraRockets:"more_missiles_upg1",addSpaceDebree:"missile_shards_upg1"},jt={addFollower:350,addPlayerMaxHealth:200,addExtraRockets:120,addSpaceDebree:110},Ae={addFollower:void 0,addPlayerMaxHealth:void 0,addExtraRockets:()=>n.rocketsLvl!==void 0,addSpaceDebree:()=>n.rocketsLvl!==void 0},Rt=45e3;function Wt(t){const r=Object.entries(jt).filter(o=>Ae[o[0]]===void 0?!0:Ae[o[0]]()),a=Rt+Ut(r.map(o=>o[1]*t)),s=Math.floor(e.rand(0,a));let i=0;for(let o=0;o<r.length;o++){const d=i+r[o][1]*t;if(s>i&&s<=d)return r[o][0];i=d}return null}function Nt(t,r){const a=Wt(r);a&&Ne(t,a)}function qt(t,r){return Math.floor(e.rand(0,r))<=t}function we(t,r,a,s){return qt(t,100)?(Le(s,a),e.play("hit1",{volume:f}),r*a):r}function qe(t,r){for(let a=0;a<r;a++){const s=e.add([e.pos(t),e.sprite("particle2"),e.animate({relative:!0}),e.rotate(e.rand(360)),e.opacity(1),{dir:e.rand(e.vec2(-1,-1),e.vec2(1,1)),speed:e.rand(40,60),lifeSpan:0},l.debree]);s.onUpdate(()=>{s.lifeSpan>s.speed||(s.move(s.dir.x*(s.speed-s.lifeSpan),s.dir.y*(s.speed-s.lifeSpan)),s.lifeSpan+=e.dt()*45)}),s.animate("opacity",[1,.5],{duration:1}),ee.push(s)}}function re(t,r){if(r.tags.includes(l.blaster)){const a=we(n.critChance,r.dmg,n.critMultiplier,r.pos);t.hurt(a)}else if(r.tags.includes(l.rocket)){const a=we(n.critChance,r.impactDmg,n.critMultiplier,t.pos);t.hurt(a),Fe(r.pos,r.splashSize,r.splashDmg,r.splashDmgFallof,r.splashDmgFallofDist),e.shake(3),ne.emitter.position=t.pos,ne.emitter.direction=r.angle-90,ne.emit(6)}}function ge(t,r,a){_.emitter.position=t,_.emit(20),qe(t,r),Nt(t,a)}function se(t,r,a,s){const i=12*s,o=e.add([e.pos(t),e.sprite("enemy_ship1"),e.rotate(0),e.anchor("center"),e.health(a),e.animate(),e.scale(s),e.offscreen({destroy:!0}),{speed:e.rand(100,130),hb:i,targetPos:e.rand(e.vec2(e.width(),e.height()))},e.state("retreat",["attack","retreat"]),l.enemy,l.unit]);o.onStateEnter("retreat",async()=>{const d=e.rand(e.vec2(e.width(),e.height()));o.targetPos=d,await e.wait(2),o.enterState("attack")}),o.onStateEnter("attack",async()=>{await e.wait(3),o.enterState("retreat")}),o.onStateUpdate("attack",()=>{const d=h.pos;o.targetPos=d;const p=o.pos.dist(o.targetPos);p<50?o.enterState("retreat"):p>50&&p<200&&Math.floor(e.rand(0,200))==1&&K(o.pos,e.Vec2.fromAngle(o.angle-90),o.angle,2,1,[l.enemy,l.blaster],!0)}),F(o),o.onUpdate(()=>{const{lerp:d}=ce(o.angle,o.pos,o.targetPos,.01,-90);ue(o,d,o.speed),J(o.pos,o.hb,l.friendly,p=>{e.destroy(p),re(o,p)})}),o.onDeath(()=>{e.play(q(),{volume:ae}),ge(o.pos,r,1),e.destroy(o)}),o.onHurt(()=>{e.play("hit1",{volume:f}),o.animation.seek(0)})}function z(t){const r=e.rand(1,2),a=12*r,s=e.add([e.pos(t.pos),e.sprite("asteroid1"),e.rotate(0),e.anchor("center"),e.scale(e.rand(1,2)),e.health(t.hp),e.animate(),e.offscreen({destroy:!0}),{vel:t.dir,rotVel:e.rand(-4,4),speed:t.speed,initScale:r,hb:a},l.enemy,l.unit]);F(s),s.onUpdate(()=>{s.move(s.vel.scale(s.speed)),s.angle+=s.rotVel,J(s.pos,s.hb,l.friendly,i=>{e.destroy(i),re(s,i)}),h.pos.dist(s.pos)<s.hb&&(h.hurt(1),s.hurt(t.hp))}),s.onDeath(()=>{if(ge(s.pos,t.scoreOnKill,1),e.play(q(),{volume:ae}),e.destroy(s),t.splitOnDeath)for(let i=0;i<t.splitOnDeath;i++)z({pos:s.pos,dir:e.rand(e.vec2(-1,-1),e.vec2(1,1)),scoreOnKill:t.scoreOnKill/2,hp:t.hp/2,speed:t.speed*2,splitOnDeath:0})}),s.onHurt(()=>{s.animation.seek(0)})}function Ft(t,r,a,s,i){const d=e.add([e.pos(r),e.sprite(i),e.rotate(a.angle()-90),e.anchor("center"),e.health(s),e.animate(),e.offscreen({destroy:!0}),{vel:a,speed:e.rand(300,340),hb:12},l.enemy,l.unit]);F(d),d.onUpdate(()=>{d.move(d.vel.scale(d.speed)),J(d.pos,d.hb,l.friendly,p=>{e.destroy(p),re(d,p)}),h.pos.dist(d.pos)<d.hb&&(h.hurt(1),d.hurt(s))}),d.onDeath(()=>{ie.emitter.position=d.pos,ie.emitter.direction=d.angle+90,ie.emit(20),e.play(q(),{volume:ae}),e.destroy(d),t.killed+=1}),d.onHurt(()=>{e.play("hit1",{volume:f}),d.animation.seek(0)})}function Ee(t){const r=e.add([e.animate(),{startPos:t.startPos,endPos:t.endPos,opacity:.15,killed:0},l.enemy]);r.onUpdate(()=>{if(Math.floor(e.rand(0,t.spawnChance))==1){const a=Gt(6);Ft(r,r.startPos.add(a),r.endPos.add(a).sub(r.startPos).unit(),4,zt())}r.opacity=e.wave(.1,.2,e.time()),r.killed>=t.destroyAfterKills&&r.destroy()}),r.onDraw(()=>{e.drawLines({pts:[r.startPos,r.endPos],width:40,opacity:r.opacity})})}const Be=["enemy_ship1","bike1"];function zt(){return Be[Math.floor(e.rand(0,Be.length))]}function Gt(t){return e.rand(e.vec2(-6,-6),e.vec2(t,t))}function Kt(t){const r=[],a=t.parts.find(s=>s.isBody);for(let s=0;s<t.parts.length;s++){const i=t.parts[s];F(i.obj),i.obj.onHurt(()=>{e.play("hit1",{volume:f}),t.parts[s].obj.animation.seek(0)}),i.obj.onDeath(()=>{const o=i.isBody?i.obj.pos:a.obj.pos.sub(i.obj.pos);if(qe(o,i.scoreOnDestroy),e.play(q(),{volume:f}),i.isBody){delete le[i.obj.id],e.destroy(i.obj),ge(i.obj.pos,10,1);return}i.obj.hidden=!0,i.obj.paused=!0,_.emitter.position=o,_.emit(20),Jt(o,i.obj.sprite,e.rand(40,80)),a.obj.jitter(20)}),r.push({obj:i.obj,localPos:i.isBody?e.vec2(0,0):i.obj.pos,hitbox:i.hitbox,isBody:i.isBody})}return r}function Jt(t,r,a){const s=e.add([e.pos(t),e.sprite(r),e.lifespan(2,{fade:.2}),e.offscreen({destroy:!0}),e.opacity(1),e.scale(1),e.rotate(e.rand(0,360)),e.move(e.rand(e.vec2(-1,-1),e.vec2(1,1)),a),{spin:e.rand(2,8)}]);s.onUpdate(()=>{const i=e.wave(-1,1,e.time()*s.spin);s.scale=e.vec2(i,i)})}function ve(){return{jitterValue:0,id:"jitter",require:["pos"],update(){if(this.jitterValue>0){const r=this.jitterValue*8;var t=e.rand(e.vec2(-r,-r),e.vec2(r,r));this.move(t),this.jitterValue-=e.dt()*100}},jitter(t){this.jitterValue=t}}}const $t=[6,2],le={};function Y(t,r,a,s,i,o){const d=16*i,p=e.add([e.pos(t),e.sprite("enemy_ship1_body"),e.rotate(r.angle()+90),e.anchor("center"),e.health(s),e.animate(),e.scale(i),ve(),e.offscreen({destroy:!0}),{vel:r,speed:o,hb:d},l.enemy,l.unit]),g=p.add([e.pos(e.vec2(-6,-2)),e.sprite("enemy_ship1_left_wing"),e.anchor("center"),e.health(Math.floor(s/2)),e.animate(),ve(),l.part]),v=p.add([e.pos(e.vec2($t[0],-2)),e.sprite("enemy_ship1_right_wing"),e.anchor("center"),e.health(Math.floor(s/2)),e.animate(),ve(),l.part]);le[p.id]=Kt({parts:[{obj:p,hitbox:8,isBody:!0,scoreOnDestroy:a},{obj:g,hitbox:8,isBody:!1,scoreOnDestroy:0},{obj:v,hitbox:8,isBody:!1,scoreOnDestroy:0}]}),p.onUpdate(()=>{p.move(p.vel.scale(p.speed)),ar(p.pos,p.hb,l.friendly,le[p.id],(P,S)=>{e.destroy(P),re(le[p.id][S].obj,P)}),Math.floor(e.rand(0,500))==10&&K(p.pos,e.Vec2.fromAngle(p.angle-90),p.angle,1,1,[l.enemy,l.blaster],!0);const x=e.Vec2.fromAngle(p.angle-90),c=e.vec2(p.pos.x-12*x.x,p.pos.y-12*x.y);U.emitter.position=c,U.emitter.direction=e.Vec2.toAngle(x),U.emit(1)})}function Yt(t,r,a){const s=document.getElementById("song"),i=document.getElementById("song_title"),o=document.getElementById("song_author"),d=document.getElementById("song_cover");o.textContent=r,i.textContent=t,d.setAttribute("src",a),s==null||s.classList.add("show")}function Qt(){const t=document.getElementById("song");t==null||t.classList.remove("show")}function Xt(t){const r=e.add([e.pos(t.pos),e.sprite("crate1"),e.rotate(0),e.anchor("center"),e.health(t.hp),e.animate(),e.offscreen({destroy:!0}),{vel:e.Vec2.fromAngle(e.rand(0,360)),rotVel:e.rand(-4,4),speed:e.rand(20,60),hitAngle:0},l.enemy,l.unit]);F(r),r.onUpdate(()=>{r.move(r.vel.scale(r.speed)),r.angle+=r.rotVel,J(r.pos,12,l.friendly,a=>{e.destroy(a),r.hitAngle=a.angle,re(r,a)}),h.pos.dist(r.pos)<16&&r.hurt(t.hp)}),r.onDeath(()=>{ge(r.pos,t.am,t.powerupMultiplier),e.play("explosion4",{volume:f}),e.destroy(r)}),r.onHurt(()=>{e.play("hit2",{volume:f}),r.animation.seek(0)})}function be(t){const r=e.add([e.pos(t.pos),e.anchor("center"),e.circle(12),e.animate(),{opacity:.15,spawned:0,maxSpawn:t.maxSpawns},l.enemy]);r.onUpdate(()=>{Math.floor(e.rand(0,t.spawnChance))==1&&(t.onSpawn(r.pos),r.spawned++),r.spawned>=r.maxSpawn&&r.destroy(),r.opacity=e.wave(.03,.4,e.time()*3)})}let M={},m=0,D=0,E=0,Oe;const B={music:"arcadia",songTitle:"Arcadia",songAuthor:"Dunderpatrullen",songAlbumCover:"/covers/arcadia_cover.jpg",bpm:.44,title:"",introduceSound:"",levelLengthSeconds:190,reset:()=>{M={},Oe.stop(),Qt()},lvlUpd:()=>{},waves:[{timeStamp:0,begin:()=>{Oe=e.play(B.music,{volume:gr})},upd:()=>{}},{timeStamp:3500,begin:()=>{Yt(B.songTitle,B.songAuthor,B.songAlbumCover)},upd:()=>{}},{timeStamp:4500,begin:t=>{var r=e.add([e.pos(e.center()),e.anchor("center"),e.animate(),e.text("...INIT SPACEJUMP...",{font:"",size:42}),l.gameLoopUi]);r.animate("opacity",[1,0],{loops:5,duration:.7}),M.txt=r},upd:()=>{}},{timeStamp:4550,duration:3550,begin:()=>{M.lines=[]},upd:t=>{var r=e.rand(e.vec2(e.width(),e.height())),a=e.add([e.pos(r),e.rect(2,4*(t/100)),e.color(e.WHITE),"dust"]);M.lines.push(a);for(let s=0;s<M.lines.length;s++)M.lines[s].move(0,-10*(t/50));t>2e3&&e.shake(.01*(t/100))}},{timeStamp:8120,begin:()=>{e.destroyAll("dust"),e.flash(e.WHITE,1),e.destroy(M.txt),delete M.lines;const t=40;for(let a=0;a<t;a++){var r=e.rand(e.vec2(e.width(),e.height()));h.pos.dist(r)<200||z({pos:r,dir:e.DOWN,scoreOnKill:1,hp:4,speed:e.rand(20,40),splitOnDeath:2})}for(let a=0;a<t/10;a++){var r=e.rand(e.vec2(e.width(),e.height()));h.pos.dist(r)<200||Xt({pos:r,am:1,hp:3,powerupMultiplier:3})}e.add([e.pos(100),e.color(e.rgb(50,50,50)),e.sprite("bg_moon1"),e.scale(2),e.layer(G.bg),l.levelBg]),e.add([e.pos(100,400),e.color(e.rgb(50,50,50)),e.sprite("bg_building1"),e.scale(2),e.layer(G.bg),l.levelBg])},upd:t=>{}},{timeStamp:16e3,begin:()=>{var t=e.add([e.pos(e.center()),e.anchor("center"),e.animate(),e.text("!!THREAT DETECTED!!",{font:"",size:42}),l.gameLoopUi]);t.animate("opacity",[1,0],{loops:10,duration:B.bpm}),M.txt=t},upd:t=>{}},{timeStamp:21e3,begin:()=>{e.destroy(M.txt);const t=6;for(let r=0;r<t;r++){const a=T(.25*(r/t));Y(a,e.DOWN,2,7,1,e.rand(40,60))}},upd:t=>{}},{timeStamp:18790,begin:()=>{e.flash(e.WHITE,B.bpm);const t=12;for(let r=0;r<t;r++){const a=T(1*(r/t));Y(a,e.Vec2.fromAngle(a.angleBetween(e.center())),2,7,1,e.rand(40,60))}},upd:t=>{}},{timeStamp:22790,begin:()=>{e.flash(e.WHITE,B.bpm);const t=12;for(let r=0;r<t;r++){const a=T(1*(r/t));Y(a,e.Vec2.fromAngle(a.angleBetween(e.center())),2,5,1,e.rand(40,60))}},upd:t=>{}},{timeStamp:36744,duration:1e3,begin:()=>{e.shake(10)},upd:t=>{if(m+=e.dt(),m>=.05){const r=e.rand(1);se(T(r),2,4,1),m=0}}},{timeStamp:43824,duration:1500,begin:()=>{m=0,D=0,E=30},upd:t=>{if(m+=e.dt(),m>=.03&&D<E){const r=.25+.25*(D/E);z({pos:T(r),dir:e.LEFT,scoreOnKill:0,hp:3,speed:40,splitOnDeath:2}),D++,m=0}}},{timeStamp:45600,duration:1500,begin:()=>{m=0,D=0,E=30},upd:t=>{if(m+=e.dt(),m>=.03&&D<E){const r=.75+.25*(D/E);z({pos:T(r),dir:e.RIGHT,scoreOnKill:0,hp:3,speed:40,splitOnDeath:2}),D++,m=0}}},{timeStamp:47e3,duration:5e3,begin:()=>{m=0,D=0,E=40;const t=6;for(let r=0;r<t;r++){const a=T(.25*(r/t));Y(a,e.DOWN,2,10,1,e.rand(40,60))}},upd:t=>{if(m+=e.dt(),m>=.03&&D<E){for(let r=0;r<2;r++){const a=.5*r+.25*(D/E);z({pos:T(a),dir:r==0?e.DOWN:e.UP,scoreOnKill:0,hp:3,speed:40,splitOnDeath:2})}D++,m=0}}},{timeStamp:66e3,duration:14e3,begin:()=>{m=0},upd:t=>{if(m+=e.dt(),m>=B.bpm*2){const r=e.rand(1);se(T(r),2,2,1),m=0}}},{timeStamp:79300,begin:()=>{m=0;for(let t=0;t<2;t++){const r=200+300*t;Ee({startPos:e.vec2(0,r),endPos:e.vec2(e.width(),r),spawnChance:90,destroyAfterKills:5})}},upd:t=>{}},{timeStamp:86450,begin:()=>{m=0;for(let r=0;r<2;r++){const a=200+300*r;Ee({startPos:e.vec2(a,0),endPos:e.vec2(a,e.height()),spawnChance:80,destroyAfterKills:5})}const t=14;for(let r=0;r<t;r++){const a=T(.25*(r/t));Y(a,e.DOWN,2,5,1,e.rand(40,60))}},upd:t=>{}},{timeStamp:97340,begin:()=>{e.flash(e.WHITE,.5)},upd:t=>{}},{timeStamp:100700,begin:()=>{e.flash(e.WHITE,.5)},upd:t=>{}},{timeStamp:107900,begin:()=>{e.flash(e.WHITE,.5);for(let t=0;t<4;t++)be({maxSpawns:5,onSpawn:r=>{se(r,2,6,1)},spawnChance:100,pos:e.rand(e.vec2(e.width(),e.height()))})},upd:t=>{}},{timeStamp:115e3,begin:()=>{for(let t=0;t<4;t++)be({maxSpawns:10,onSpawn:r=>{se(r,2,6,1)},spawnChance:70,pos:e.rand(e.vec2(e.width(),e.height()))})},upd:t=>{}},{timeStamp:125e3,begin:()=>{for(let t=0;t<6;t++)be({maxSpawns:10,onSpawn:r=>{z({pos:r,hp:15,dir:e.rand(e.vec2(-1,-1),e.vec2(1,1)),scoreOnKill:2,speed:e.rand(80,120),splitOnDeath:Math.floor(e.rand(3))})},spawnChance:50,pos:e.rand(e.vec2(e.width(),e.height()))})},upd:t=>{}}]},Zt=1;let h,de=0,ee=[];const A=[];function er(){h=Bt(),wt(),kt(n.maxHealth)}function tr(){const t=e.dt();de+=t,de>=Zt&&!Te()&&(xt(B),Ne(e.center(),"addPlayerMaxHealth")),Te()&&Dt()&&(de=0,Ce());for(let r=0;r<ee.length;r++){const a=ee[r],s=a.pos.dist(h.pos);s<n.debreeSeekDistance*n.debreeSeekDistanceMultiplier&&(a.moveTo(h.pos,n.debreeSeekSpeed*n.debreeSeekSpeedMultiplier),s<n.debreePickupDistance&&(e.destroy(a),ee.splice(r,1),e.play("collect1",{volume:f}),Qe(n.scorePerPickup),r--))}}function rr(){Ot(),de=0,ee=[],Ce(),e.destroyAll(l.enemy),e.destroyAll(l.blaster),e.destroyAll(l.rocket),e.destroyAll(l.enemy),e.destroyAll(l.levelBg),e.destroyAll(l.unit),e.destroyAll(l.debree),e.destroyAll(l.props),Tt(),ke(W.LevelUp)}function Fe(t,r,a,s,i){const o=e.query({include:[l.enemy,l.unit],includeOp:"and"});ye.emitter.position=t,ye.emit(14),Le(t,2);for(let d=0;d<o.length;d++)if(o[d].pos.dist(t)<r){const p=we(n.critChance,a,n.critMultiplier,o[d].pos);o[d].hurt(p)}}function J(t,r,a,s){for(let i=0;i<A.length;i++){const o=A[i];if(o.pos.dist(t)<r){if(!o.tags.includes(a))continue;s(o)}}}function ar(t,r,a,s,i){for(let o=0;o<A.length;o++){const d=A[o];if(d.pos.dist(t)<r){if(!d.tags.includes(a))continue;for(let p=0;p<s.length;p++)if(!s[p].obj.hidden&&d.pos.dist(t.sub(s[p].localPos))<s[p].hitbox){i(d,p);return}}}}function ze(t,r,a,s){const i=e.query({include:[a,l.unit],includeOp:"and"});for(let o=0;o<i.length;o++){const d=i[o];if(d.pos.dist(t)<r)return s(d),!0}return!1}function sr(){if(!h)return;O.extraHealth++;const t=n.maxHealth+O.extraHealth;h.setMaxHP(t),je(t-1),h.heal(),Re(h.hp())}const X="ui_grid";let H,u={group:void 0,title:void 0,header:void 0,desc:void 0,icon:void 0},_e={},Ge,Ke;function or(){const t=e.center(),r=xe(e.vec2(t.x,40),"ui");r.add([e.text("UPGRADE",{size:22,font:"unscii"}),e.anchor("center")]),Ge=pr(r,12,Ye(N),e.vec2(0,50)),Je(t),u.group=xe(e.vec2(t.x+t.x/2-100,t.y-t.y/2-40),"ui"),u.group.hidden=!0,lr(),dr("START GAME",e.vec2(t.x,t.y*2-60),()=>{ir(),ke(W.Playing)})}function ir(){e.destroyAll("ui"),e.destroyAll(X)}function Je(t){e.destroyAll(X);const r=xe(e.vec2(60,t.y),X);var a=te,s=Object.entries(a).filter(([v,x])=>x.requiredTool?V[x.requiredTool]!==void 0:!0).map(([v,x])=>v);const i=4;let o=-1;const d=42,p=8,g=16;for(let v=0;v<s.length;v++){const x=te[s[v]],c=Ie(s[v]);v%i==0&&o++;const P=v-i*o,S=r.add([e.pos(e.vec2((d+p)*P,(d+p)*o)),e.rect(d,d),e.area(),e.color(0,0,0),e.anchor("center"),e.outline(1,new e.Color(255,255,255)),X]),k=S.add([e.rect(d+6,d+6),e.pos(0,0),e.color(0,0,0),e.anchor("center"),e.outline(2,new e.Color(255,255,255)),X]);k.hidden=!0,_e[s[v]]=k,c>0&&S.add([e.pos(g,-21),e.rect(g,g),e.anchor("center"),e.color(255,255,255)]).add([e.text(`${c}`,{size:14,font:"unscii"}),e.pos(0,2),e.anchor("center"),e.color(0,0,0)]);const I=e.clamp(c,0,x.upgrades.length-1);S.add([e.sprite(x.upgrades[I].sprite,{height:24,width:24}),e.anchor("center")]),S.onClick(()=>nr(s[v],c,S.worldPos()))}}function nr(t,r,a){H&&(_e[H.key].hidden=!0),_e[t].hidden=!1,$e(t,r),e.play("click1",{volume:f}),Ke=a}function lr(){u.header=u.group.add([e.text("LEVEL 1",{size:10,font:"unscii"}),e.anchor("top"),e.pos(200/2,0)]),u.title=u.group.add([e.text("BLASTER",{size:14,font:"unscii"}),e.anchor("top"),e.pos(200/2,22)]);const a=u.group.add([e.pos(0,80),e.rect(200,300),e.color(0,0,0),e.outline(2,new e.Color(255,255,255))]),s=a.add([e.rect(200/2,60),e.color(0,0,0),e.anchor("center"),e.pos(200/2,10),e.outline(2,new e.Color(255,255,255))]);u.icon=s.add([e.sprite("ship",{height:32,width:32}),e.anchor("center")]),u.desc=a.add([e.pos(0,80),e.text("EQUIPE YOUR SHIP WITH A LASER BLASTER, LEFT MOUSE TO FIRE",{size:12,font:"unscii",width:200,align:"center",lineSpacing:12})]),u.purchaseBtn=u.group.add([e.rect(240,50),e.area(),e.opacity(1),e.anchor("center"),e.pos(200/2,340)]),u.purchaseBtnText=u.purchaseBtn.add([e.text("PURCHASE 12P",{size:16,font:"unscii"}),e.color(0,0,0),e.anchor("center")]),u.purchaseBtn.onClick(()=>{var o;if(u.group.hidden||(o=u.purchaseBtn)!=null&&o.hidden)return;const i=te[H.key].upgrades[H.index];if(N<i.price){e.play("error",{volume:f});return}Qe(-i.price),ht(H.key),Je(e.center()),$e(H.key,H.index+1),_.emitter.position=Ke,_.emit(20),Ve(),e.play("purchase1",{volume:f}),Ge.text=Ye(N)})}function $e(t,r){const a=te[t],s=e.clamp(r,0,a.upgrades.length-1);u.group.hidden=!1;const i=a.upgrades[s];if(u.title.text=a.toolName.toUpperCase(),u.desc.text=i.desc.toUpperCase(),u.header.text=i.name.toUpperCase(),u.icon.sprite=i.sprite,H={key:t,index:s},r!=s){u.purchaseBtn.hidden=!0;return}if(u.purchaseBtnText.text=`PURCHASE ${i.price}P`,u.purchaseBtn.hidden=!1,N<i.price){u.purchaseBtn.opacity=.3;return}u.purchaseBtn.opacity=1}function dr(t,r,a){const s=e.add([e.pos(r),e.rect(300,50),e.area(),e.color(0,0,0),e.anchor("center"),"ui"]);return s.add([e.text(t,{size:16,font:"unscii"}),e.anchor("center")]),s.onClick(a),s}function pr(t,r,a,s){return t.add([e.rect(80,40),e.pos(s),e.anchor("center"),e.outline(2,new e.Color(255,255,255)),e.color(0,0,0)]).add([e.text(a,{size:r,font:"unscii"}),e.anchor("center")])}function xe(t,r){return e.add([e.pos(t),r])}function Ye(t){return`${t}P`}const G={bg:"bg",game:"game",ui:"ui"},W={Playing:1,LevelUp:2},oe=-22;let N=60;const cr=320,ur=280;let Pe=0;const w=[],ae=.3,f=.5,gr=.6;let pe=W.Playing;const e=Xe({background:"#000000",global:!1,scale:1.2,width:700,height:700});vt(e).then(()=>{_t(),mr(),e.setLayers([G.bg,G.game,G.ui],G.game),hr(),ke(W.LevelUp),e.onUpdate(()=>{pe==W.Playing&&(Pe+=e.dt(),tr())})});function ke(t){pe=t,pe==W.Playing?er():pe==W.LevelUp&&(He("slot1"),or())}function Qe(t){N+=t}function mr(){var t=St("slot1");t&&(ft(t.loadout),N=t.score,Pe=t.time,Ve())}function hr(){const t=e.center();w.push(e.vec2(22,22)),w.push(e.vec2(t.x*2+oe,22)),w.push(e.vec2(t.x*2+oe,t.y*2+oe)),w.push(e.vec2(22,t.y*2+oe))}function T(t){const r=Math.floor(w.length*t),a=1/w.length*r,s=(t-a)*w.length,i=(r+1>=w.length?w[0]:w[r+1]).sub(w[r]),o=e.clamp(r,0,w.length-1);return w[o].add(i.scale(s))}
//# sourceMappingURL=index-CuCyhGeK.js.map
